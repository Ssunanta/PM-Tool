<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intern Management</title>

  <style>
:root {
      --bg: #f3f3f3;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 10px 28px rgba(15, 23, 42, .10);
      --shadow2: 0 4px 12px rgba(15, 23, 42, .08);
      --radius: 16px;
      --radius2: 12px;
      --btn: #111;
      --btnHover: #000;
      --purple: #8b5cf6;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      -webkit-text-size-adjust: 100%;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto 20px;
      padding: 22px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 24px;
      font-weight: 900;
      letter-spacing: .2px;
      margin-bottom: 14px;
    }

    .title .dot {
      width: 14px;
      height: 14px;
      border-radius: 5px;
      background: var(--purple);
      box-shadow: 0 6px 16px rgba(139, 92, 246, .35);
      display: inline-block;
    }

    /* =========================================================
     ‚úÖ CONTROLS ROW - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ flex items ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô
     ========================================================= */

.intern-controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 16px;
  padding: 14px;
  background: #f8fafc;
  border: 1px solid rgba(15, 23, 42, .08);
  border-radius: 16px;
  box-shadow: var(--shadow2);
}

.intern-controls input {
  height: 44px;
  padding: 0 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: #fff;
  font-size: 14px;
  font-weight: 900;
  box-shadow: 0 6px 16px rgba(15, 23, 42, .06);
  flex: 1 1 200px;
  min-width: 200px;
}

.intern-controls input::placeholder {
  color: #94a3b8;
  font-weight: 900;
}

.intern-controls input:focus {
  outline: none;
  border-color: #111;
  box-shadow: 0 10px 22px rgba(15, 23, 42, .10);
}

.intern-controls button {
  height: 44px;
  padding: 0 14px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: #fff;
  cursor: pointer;
  font-size: 14px;
  font-weight: 900;
  box-shadow: 0 6px 16px rgba(15, 23, 42, .06);
  transition: 0.2s;
  white-space: nowrap;
  flex: 0 1 auto;
  min-width: fit-content;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.intern-controls button:hover {
  border-color: #cbd5e1;
  background: #fafafa;
}

/* ‡∏õ‡∏∏‡πà‡∏° ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏á‡∏≤‡∏ô */
.manage-btn {
  height: 44px;
  padding: 0 18px;
  border-radius: 14px;
  border: none;
  background: var(--btn);
  color: #fff;
  font-size: 14px;
  font-weight: 900;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  box-shadow: var(--shadow2);
  white-space: nowrap;
  opacity: 1;
  flex: 0 1 auto;
  min-width: fit-content;
}

#internManageBtn {
  -webkit-appearance: none;
  appearance: none;
  border: none;
  outline: none;
  -webkit-text-fill-color: #fff;
  text-rendering: geometricPrecision;
  background-color: var(--btn);
  color: #fff;
}

#internManageBtn span {
  color: #fff;
  -webkit-text-fill-color: #fff;
  font-weight: inherit;
}

.manage-btn:hover {
  background: var(--btnHover);
}

.manage-btn.active {
  background: #10b981;
}

.intern-controls .manage-btn {
  background: var(--btn);
  color: #fff;
  border: none;
}

.intern-controls .manage-btn:hover {
  background: var(--btnHover);
  color: #fff;
  border: none;
}

.intern-controls .manage-btn.active {
  background: #10b981;
  color: #fff;
}

.intern-controls button:last-child {
  background: #fff;
  border: 1px solid rgba(15, 23, 42, .16);
}

.intern-controls button:last-child:hover {
  background: #f1f5f9;
  border-color: rgba(15, 23, 42, .22);
}

/* =========================================================
 ‚úÖ CUSTOM DROPDOWN (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
 ========================================================= */

.intern-controls select {
  display: none !important;
}

.custom-dropdown-intern {
  position: relative;
  flex: 0 1 auto;
  width: 260px;
  min-width: 180px;
  max-width: 260px;
}

.dropdown-selected-intern {
  padding: 12px 14px;
  border-radius: 14px;
  background: #fff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  border: 1px solid var(--border);
  font-size: 14px;
  font-weight: 900;
  box-shadow: var(--shadow2);
  width: 100%;
  height: 44px;
  gap: 10px;
}

#selectedPositionText {
  display: block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: calc(100% - 24px);
}

.dropdown-selected-intern:hover {
  border-color: #cbd5e1;
}

.dropdown-items-intern {
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background: #f1f5f9;
  border: 1px solid var(--border);
  border-radius: 16px;
  margin-top: 8px;
  max-height: 360px;
  overflow-y: auto;
  display: none;
  z-index: 100;
  padding: 10px;
  box-shadow: var(--shadow);
}

.dropdown-items-intern.open {
  display: block;
}

.dd-item-intern {
  display: block;
  padding: 12px 12px;
  border-radius: 14px;
  cursor: pointer;
  font-size: 15px;
  color: #111;
  border: 1px solid rgba(15, 23, 42, .06);
  background: #fff;
  font-weight: 900;
  white-space: normal;
  word-break: normal;
  overflow-wrap: anywhere;
  line-height: 1.25;
}

.dd-item-intern+.dd-item-intern {
  margin-top: 8px;
}

.dd-item-intern:hover {
  background: #fafafa;
  border-color: rgba(15, 23, 42, .12);
}

/* =========================================================
 ‚úÖ STATUS DROPDOWN (custom)
 ========================================================= */
.status-dd {
  position: relative;
  display: inline-block;
  width: 140px;
}

.status-selected {
  height: 36px;
  padding: 0 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  cursor: pointer;
  box-shadow: var(--shadow2);
  font-size: 13px;
  font-weight: 900;
  user-select: none;
}

.status-selected:hover {
  border-color: #cbd5e1;
  background: #fafafa;
}

.status-items {
  position: fixed;
  margin-top: 6px;
  background: #f1f5f9;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 8px;
  display: none;
  z-index: 250;
  box-shadow: var(--shadow);
  min-width: 140px;
}

.status-items.open {
  display: block;
}

.status-item {
  padding: 10px 10px;
  border-radius: 12px;
  background: #fff;
  cursor: pointer;
  text-align: center;
  border: 1px solid rgba(15, 23, 42, .06);
  font-size: 13px;
  font-weight: 900;
}

.status-item+.status-item {
  margin-top: 8px;
}

.status-item:hover {
  background: #fafafa;
  border-color: rgba(15, 23, 42, .12);
}

/* =========================================================
 TABLE WRAPPER
 ========================================================= */
.table-wrap {
  margin-top: 8px;
  border: 1px solid var(--border);
  border-radius: 18px;
  overflow: hidden;
  box-shadow: var(--shadow2);
  background: #fff;
  display: flex;
  flex-direction: column;
  max-height: 100vh;
}

.table-header-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
  flex-shrink: 0;
  scrollbar-width: none;
}

.table-header-wrapper::-webkit-scrollbar {
  height: 0;
}

.table-body-wrapper {
  overflow-y: auto;
  overflow-x: auto;
  flex: 1;
  -webkit-overflow-scrolling: touch;
}

body {
  overflow-x: hidden;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  table-layout: fixed;
  min-width: 1020px;
}

table thead th {
  background: #f8fafc;
  font-weight: 900;
  color: #111827;
  border-bottom: 1px solid var(--border);
  padding: 14px;
  font-size: 14px;
  text-align: center;
  vertical-align: middle;
  position: sticky;
  top: 0;
  z-index: 10;
}

table tbody td {
  padding: 14px;
  font-size: 14px;
  border-bottom: 1px solid rgba(15, 23, 42, .06);
  text-align: center;
  vertical-align: middle;
  color: #333;
}

table tbody tr:nth-child(odd) {
  background: #fff;
}

table tbody tr:nth-child(even) {
  background: #fcfcfd;
}

table tbody tr:hover {
  background: #f7fafc;
}

table input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--btn);
}

table select {
  padding: 6px 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  font-size: 13px;
  font-weight: 900;
  cursor: pointer;
  background: #fff;
  box-shadow: var(--shadow2);
}

table select:focus {
  outline: none;
  border-color: var(--btn);
  box-shadow: 0 10px 22px rgba(15, 23, 42, .10);
}

.delete-btn {
  padding: 6px 10px;
  border-radius: 10px;
  border: 1px solid rgba(239, 68, 68, .35);
  background: #fff1f2;
  color: #b91c1c;
  cursor: pointer;
  font-size: 12px;
  font-weight: 900;
  transition: 0.2s;
}

.delete-btn:hover {
  filter: brightness(.95);
}

a {
  color: #1a73e8;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

.loading {
  text-align: center;
  padding: 50px;
  color: #999;
  font-weight: 900;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 18px;
  font-weight: 900;
  margin: 20px 0 16px 0;
  color: #111827;
  letter-spacing: .2px;
  gap: 12px;
  flex-wrap: wrap;
}

.h3-actions {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.section-header button {
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
  cursor: pointer;
  font-size: 13px;
  font-weight: 900;
  box-shadow: var(--shadow2);
  transition: 0.2s;
  white-space: nowrap;
}

.section-header button:hover {
  border-color: #cbd5e1;
  background: #fafafa;
}

#startingAddForm,
#endingAddForm,
#addInternForm {
  display: none;
  gap: 10px;
  align-items: center;
  margin-top: 14px;
  padding: 14px;
  background: #f8fafc;
  border-radius: 12px;
  flex-wrap: wrap;
  border: 1px solid rgba(15, 23, 42, .08);
}

#startingAddForm.show,
#endingAddForm.show,
#addInternForm.show {
  display: flex;
}

#startingAddForm input,
#endingAddForm input,
#addInternForm input {
  height: 44px;
  padding: 0 12px;
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 13px;
  font-weight: 900;
  box-shadow: var(--shadow2);
  flex: 1;
  min-width: 160px;
  background: #fff;
}

#startingAddForm input:focus,
#endingAddForm input:focus,
#addInternForm input:focus {
  outline: none;
  border-color: var(--btn);
  box-shadow: 0 10px 22px rgba(15, 23, 42, .10);
}

#startingAddForm button,
#endingAddForm button,
#addInternForm button {
  height: 44px;
  padding: 0 14px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #fff;
  cursor: pointer;
  font-size: 13px;
  font-weight: 900;
  box-shadow: var(--shadow2);
  transition: 0.2s;
  white-space: nowrap;
}

#startingAddForm button:hover,
#endingAddForm button:hover,
#addInternForm button:hover {
  background: #f7f7f7;
  border-color: #cbd5e1;
}

/* =========================================================
 RESPONSIVE - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ input search ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°
 ========================================================= */

@media (max-width: 1200px) {
  .container {
    padding: 20px;
  }

  .intern-controls {
    flex-wrap: wrap;
  }

  .intern-controls input {
    flex: 1 1 auto;
    min-width: 160px;
  }

  .custom-dropdown-intern {
    width: 220px;
    min-width: 220px;
    max-width: 220px;
  }

  #internManageBtn,
  .intern-controls button:last-child {
    flex: 0 0 auto;
  }

  table {
    min-width: 1000px;
  }
}

@media (max-width: 920px) {
  .container {
    padding: 18px;
    margin: 0 auto 18px;
  }

  .title {
    font-size: 22px;
  }

  .section-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .h3-actions {
    width: 100%;
    justify-content: flex-start;
  }

  .intern-controls {
    padding: 12px;
    flex-direction: column;
  }

  .intern-controls input {
    width: 100%;
    order: 1;
  }

  .custom-dropdown-intern {
    width: 100%;
    max-width: none;
    order: 2;
  }

  #internManageBtn {
    width: 100%;
    order: 3;
  }

  .intern-controls button:last-child {
    width: 100%;
    order: 4;
  }

  table th,
  table td {
    padding: 12px 10px;
    font-size: 13px;
  }

  .table-wrap {
    max-height: 500px;
  }
}

@media (max-width: 768px) {
  .container {
    padding: 16px;
    border-radius: 14px;
  }

  .title {
    font-size: 20px;
    margin-bottom: 12px;
  }

  .intern-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 12px;
  }

  .intern-controls input {
    width: 100%;
    height: 48px;
    font-size: 15px;
    order: 1;
  }

  .custom-dropdown-intern {
    width: 100%;
    order: 2;
  }

  .dropdown-selected-intern {
    height: 48px;
    font-size: 15px;
  }

  #internManageBtn {
    width: 100%;
    height: 48px;
    font-size: 15px;
    order: 3;
  }

  .intern-controls button:last-child {
    width: 100%;
    height: 48px;
    font-size: 15px;
    order: 4;
  }

  .status-dd {
    width: 130px;
  }

  .table-wrap {
    max-height: 450px;
  }

  #startingAddForm,
  #endingAddForm,
  #addInternForm {
    padding: 12px;
    gap: 8px;
  }

  #startingAddForm input,
  #endingAddForm input,
  #addInternForm input {
    min-width: 140px;
    height: 48px;
    font-size: 15px;
  }

  #startingAddForm button,
  #endingAddForm button,
  #addInternForm button {
    height: 48px;
    font-size: 15px;
  }

  .section-header button {
    height: 44px;
    font-size: 14px;
    padding: 0 16px;
  }
}

@media (max-width: 480px) {
  .container {
    padding: 14px;
    margin: 0 auto 16px;
  }

  .title {
    font-size: 20px;
    margin-bottom: 14px;
  }

  .intern-controls {
    padding: 12px;
    gap: 10px;
  }

  .intern-controls input {
    height: 52px;
    font-size: 17px;
  }

  .intern-controls button,
  .manage-btn {
    height: 52px;
    font-size: 17px;
  }

  .section-header {
    font-size: 17px;
    margin: 18px 0 12px 0;
  }

  table {
    min-width: 880px;
  }

  table thead th {
    font-size: 12px;
    padding: 10px 6px;
  }

  table tbody td {
    padding: 10px 6px;
    font-size: 12px;
  }
}
  </style>

</head>

<body>

<!-- MAIN INTERN DATA -->
  <div class="container">
    <div class="title">
      <img src="https://img.icons8.com/?size=100&id=wNJfNKpLXXlt&format=png&color=000000" alt="users" style="width:24px;height:24px;">
      ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡πá‡∏Å‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
    </div>

    <div class="intern-controls">
      <input type="text" id="internSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠" oninput="filterInterns()" />

      <button id="internManageBtn" class="manage-btn" onclick="toggleInternManageMode()">
        <img src="https://img.icons8.com/?size=100&id=bDKqvw7V0ANQ&format=png&color=000000" alt="plus" style="width:16px;height:16px;">
        <span>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</span>
      </button>

      <div class="custom-dropdown-intern">
        <div class="dropdown-selected-intern" id="positionDropdownToggle" onclick="togglePositionDropdown()">
          <span id="selectedPositionText">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
          <span>‚ñæ</span>
        </div>
        <div class="dropdown-items-intern" id="positionDropdownItems">
          <div class="dd-item-intern" onclick="selectPosition('', '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
      </div>

      <button onclick="clearInternFilters()">
  ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
</button>
    </div>

    <div class="table-wrap">
<div class="table-header-wrapper">
  <table>
<!-- Table Header -->
<colgroup>
  <col style="width:120px;">   <!-- ‡∏ä‡∏∑‡πà‡∏≠ -->
  <col style="width:150px;">   <!-- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
  <col style="width:70px;">    <!-- ‡πÄ‡∏ä‡πâ‡∏≤ -->
  <col style="width:70px;">    <!-- ‡∏ö‡πà‡∏≤‡∏¢ -->
  <col style="width:140px;">   <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
  <col style="width:200px;">   <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
  <col style="width:180px;">   <!-- ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô -->
  <col id="internActionsHeaderCol" style="width:100px; display:none;">   <!-- ‡∏•‡∏ö -->
</colgroup>
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
        <th>‡πÄ‡∏ä‡πâ‡∏≤</th>
        <th>‡∏ö‡πà‡∏≤‡∏¢</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th>‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô</th>
        <th id="internActionsHeader" style="display:none;">‡∏•‡∏ö</th>
      </tr>
    </thead>
  </table>
</div>

<div class="table-body-wrapper">
  <table>
<colgroup>
  <col style="width:120px;">   <!-- ‡∏ä‡∏∑‡πà‡∏≠ -->
  <col style="width:150px;">   <!-- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
  <col style="width:70px;">    <!-- ‡πÄ‡∏ä‡πâ‡∏≤ -->
  <col style="width:70px;">    <!-- ‡∏ö‡πà‡∏≤‡∏¢ -->
  <col style="width:140px;">   <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
  <col style="width:200px;">   <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
  <col style="width:180px;">   <!-- ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô -->
  <col id="internActionsBodyCol" style="width:100px; display:none;">   <!-- ‡∏•‡∏ö -->
</colgroup>

          <tbody id="internTableBody">
            <tr>
              <td colspan="7" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏° inline ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡πá‡∏Å‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô -->
    <div id="addInternForm">
      <input type="text" id="newInternName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡πá‡∏Å‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô">
      <input type="text" id="newInternPosition" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" list="addInternPositionDatalist">
      <datalist id="addInternPositionDatalist"></datalist>
      <input type="text" id="newInternNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
      <input type="text" id="newInternFileLink" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
      <button onclick="addNewInternSubmit()">
        <img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:16px;height:16px;">
        ‡πÄ‡∏û‡∏¥‡πà‡∏°
      </button>
      <button onclick="hideAddInternForm()">
        <img src="https://img.icons8.com/?size=100&id=QlMnqMXDMws3&format=png&color=000000" alt="close" style="width:16px;height:16px;">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
    </div>

  </div>

  <!-- STARTING -->
  <div class="container">
    <div class="section-header">
      <span>
        <img src="https://img.icons8.com/?size=100&id=WO3eRAu5RSGP&format=png&color=000000" alt="sprout" style="width:20px;height:20px;">
        ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
      </span>
      <div class="h3-actions">
        <button onclick="toggleStartingAdd()">
          <img src="https://img.icons8.com/?size=100&id=XpyLr4ervzGM&format=png&color=000000" alt="add" style="width:14px;height:14px;">
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠
        </button>
        <button id="editStartingBtn" onclick="toggleEditStarting()">
          <img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;">
          ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        </button>
      </div>
    </div>

    <div class="table-wrap">
      <div class="table-header-wrapper">
        <table>
          <thead>
            <tr>
              <th>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á/‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
              <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th>‡πÅ‡∏à‡πâ‡∏á</th>
              <th id="startingActionCol" style="display:none;">‡∏•‡∏ö</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="table-body-wrapper">
        <table>
          <tbody id="internStartingBody">
            <tr>
              <td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="startingAddForm">
      <input type="text" id="startingFullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á/‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
      <input type="text" id="startingNickName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
      <input type="text" id="startingPosition" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
      <input type="text" id="startingDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô 01/01/2026)">
      <button onclick="addStartingIntern()">
        <img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:16px;height:16px;">
        ‡πÄ‡∏û‡∏¥‡πà‡∏°
      </button>
      <button onclick="toggleStartingAdd()">
        <img src="https://img.icons8.com/?size=100&id=QlMnqMXDMws3&format=png&color=000000" alt="close" style="width:16px;height:16px;">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
    </div>
  </div>

  <!-- ENDING -->
  <div class="container">
    <div class="section-header">
      <span>
        <img src="https://img.icons8.com/?size=100&id=XVGCqo0GC6fq&format=png&color=000000" alt="hourglass" style="width:20px;height:20px;">
        ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
      </span>
      <div class="h3-actions">
        <button onclick="toggleEndingAdd()">
          <img src="https://img.icons8.com/?size=100&id=XpyLr4ervzGM&format=png&color=000000" alt="add" style="width:14px;height:14px;">
          ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠
        </button>
        <button id="editEndingBtn" onclick="toggleEditEnding()">
          <img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;">
          ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        </button>
      </div>
    </div>

    <div class="table-wrap">
      <div class="table-header-wrapper">
        <table>
          <thead>
            <tr>
              <th>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á/‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
              <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</th>
              <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
              <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
              <th>‡πÅ‡∏à‡πâ‡∏á</th>
              <th id="endingActionCol" style="display:none;">‡∏•‡∏ö</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="table-body-wrapper">
        <table>
          <tbody id="internEndingBody">
            <tr>
              <td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="endingAddForm">
      <input type="text" id="endingFullName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á/‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
      <input type="text" id="endingNickName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
      <input type="text" id="endingPosition" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
      <input type="text" id="endingDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤">
      <button onclick="addEndingIntern()">
        <img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:16px;height:16px;">
        ‡πÄ‡∏û‡∏¥‡πà‡∏°
      </button>
      <button onclick="toggleEndingAdd()">
        <img src="https://img.icons8.com/?size=100&id=QlMnqMXDMws3&format=png&color=000000" alt="close" style="width:16px;height:16px;">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
    </div>
  </div>

  <script>
/* API Adapter - PM Project API */
(function initBackendAdapter() {
  const API_BASE = "http://localhost:3000";

  window.BACKEND = {
    async getInternData(page = 1, limit = 100, search = "", role = "") {
      try {
        // ‚úÖ ‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (pagination) ‡∏à‡∏ô‡∏´‡∏°‡∏î
        const all = [];
        let p = Number(page || 1);
        const lim = Number(limit || 100);

        while (true) {
          const params = new URLSearchParams();
          params.set("page", String(p));
          params.set("limit", String(lim));
          if (search && String(search).trim()) params.set("search", String(search).trim());
          if (role && String(role).trim()) params.set("role", String(role).trim());

          const url = `${API_BASE}/members?${params.toString()}`;

          const res = await fetch(url, { method: "GET", headers: { "Accept": "application/json" } });

          if (!res.ok) {
            const txt = await res.text().catch(() => "");
            console.error("GET /members failed:", res.status, txt);
            // ‚ùå ‡∏≠‡∏¢‡πà‡∏≤‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ backend ‡∏ï‡∏≠‡∏ö 400/500
            break;
          }

          const data = await res.json().catch(() => ({}));

          const items = Array.isArray(data?.data) ? data.data : (Array.isArray(data) ? data : []);
          all.push(...items);

          const totalPages = Number(data?.pagination?.totalPages || 1);
          if (p >= totalPages) break;
          p += 1;
        }

        return { items: all, pagination: { loadedAll: true } };
      } catch (err) {
        console.error("‡πÇ‡∏´‡∏•‡∏î interns ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
        return { items: [], pagination: {} };
      }
    },

    async getInternStarting() {
      try {
        const res = await fetch(`${API_BASE}/events?search=starting&limit=100`, { method: "GET" });
        if (!res.ok) return [];
        const data = await res.json();
        return (data.data || []).filter(e => e.tags && e.tags.includes("starting"));
      } catch (err) {
        return [];
      }
    },

    async getInternEnding() {
      try {
        const res = await fetch(`${API_BASE}/events?search=ending&limit=100`, { method: "GET" });
        if (!res.ok) return [];
        const data = await res.json();
        return (data.data || []).filter(e => e.tags && e.tags.includes("ending"));
      } catch (err) {
        return [];
      }
    },

    async saveInternStarting(payload) {
      try {
        for (const item of payload) {
          const eventData = {
            title: `${item.fullName} ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô`,
            description: `‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${item.position}, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${item.dateRange}`,
            tags: ["starting", item.position],
            start: new Date().toISOString(),
            status: item.notifyStatus ? "COMPLETED" : "NOT_STARTED"
          };

          await fetch(`${API_BASE}/events`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(eventData)
          });
        }
        return { success: true };
      } catch (err) {
        console.error("saveInternStarting error:", err);
        return { success: false, message: err.message };
      }
    },

    async saveInternEnding(payload) {
      try {
        for (const item of payload) {
          const eventData = {
            title: `${item.fullName} ‡∏à‡∏ö‡∏á‡∏≤‡∏ô`,
            description: `‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${item.position}, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${item.dateRange}`,
            tags: ["ending", item.position],
            start: new Date().toISOString(),
            status: item.notifyStatus ? "COMPLETED" : "NOT_STARTED"
          };

          await fetch(`${API_BASE}/events`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(eventData)
          });
        }
        return { success: true };
      } catch (err) {
        console.error("saveInternEnding error:", err);
        return { success: false, message: err.message };
      }
    },

    async addNewIntern(name, position, note, fileLink) {
      try {
        // ‚úÖ Backend ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ role" ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å field fileLink
        // ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ field ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + role intern
        const basePayload = {
          displayName: name,
          position: position,
          note: note,
          role: "intern"
        };

        const attempts = [
          basePayload,
          { ...basePayload, role: "INTERN" },
          { ...basePayload, role: "Intern" }
        ];

        let lastTxt = "";

        for (const payload of attempts) {
          const res = await fetch(`${API_BASE}/members`, {
            method: "POST",
            headers: { "Content-Type": "application/json", "Accept": "application/json" },
            body: JSON.stringify(payload)
          });

          if (res.ok) {
            const created = await res.json().catch(() => ({}));

            // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö fileLink ‡πÑ‡∏ß‡πâ local ‡∏ï‡πà‡∏≠ memberId (‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á DTO ‡∏ù‡∏±‡πà‡∏á backend)
            const id = String(created?._id || created?.id || "");
            if (id && fileLink && String(fileLink).trim()) {
              writeMeta(id, { fileLink: String(fileLink).trim() });
            }
            return { success: true, created };
          }

          lastTxt = await res.text().catch(() => "");
          console.error("POST /members failed:", res.status, lastTxt);
        }

        return { success: false, message: lastTxt || "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" };
      } catch (err) {
        return { success: false, message: err.message };
      }
    },

    async updateIntern(memberId, name, position, note, fileLink) {
      try {
        const memberData = {
          displayName: name,
          position: position,
          note: note
        };

        const res = await fetch(`${API_BASE}/members/${memberId}`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json", "Accept": "application/json" },
          body: JSON.stringify(memberData)
        });

        if (!res.ok) {
          const txt = await res.text().catch(() => "");
          console.error("PATCH /members/:id failed:", res.status, txt);
          return { success: false, message: txt || "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" };
        }

        // ‚úÖ fileLink ‡πÄ‡∏Å‡πá‡∏ö local
        if (fileLink && String(fileLink).trim()) {
          writeMeta(String(memberId), { fileLink: String(fileLink).trim() });
        } else {
          writeMeta(String(memberId), { fileLink: "" });
        }

        return { success: true };
      } catch (err) {
        return { success: false, message: err.message };
      }
    },

    async deleteIntern(memberId) {
      try {
        const res = await fetch(`${API_BASE}/members/${memberId}`, {
          method: "DELETE",
          headers: { "Content-Type": "application/json" }
        });

        if (!res.ok) {
          const err = await res.json();
          return { success: false, message: err.message || "‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" };
        }

        return { success: true };
      } catch (err) {
        return { success: false, message: err.message };
      }
    },

    async updateInternCheckbox(memberId, col, checked) {
      // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ä‡πâ‡∏≤/‡∏ö‡πà‡∏≤‡∏¢‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage (‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á backend)
      const id = String(memberId || "");
      if (id) {
        if (col === "D") writeMeta(id, { morning: !!checked });
        if (col === "E") writeMeta(id, { noon: !!checked });
      }
      return { success: true };
    },

    async updateInternStatus(memberId, status) {
      // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage (‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á backend)
      const id = String(memberId || "");
      if (id) writeMeta(id, { status: String(status || "") });
      return { success: true };
    }
  };
})();

/* Intern Module */
(function initInternTabOnce() {
  if (window.__internTabInited) return;
  window.__internTabInited = true;

  const S = window.__internState = {
    internData: [],
    internFiltered: [],
    internStartingData: [],
    internEndingData: [],
    editingStarting: false,
    editingEnding: false,
    positions: [],
    internManageMode: false,
    selectedPosition: ""
  };

  // ‚úÖ Local meta (‡πÄ‡∏ä‡πâ‡∏≤/‡∏ö‡πà‡∏≤‡∏¢/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞) ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage ‡∏ï‡πà‡∏≠ memberId
  function metaKey(memberId){ return `pm_intern_meta:${memberId}`; }

  function readMeta(memberId){
    try { return JSON.parse(localStorage.getItem(metaKey(memberId)) || "{}") || {}; }
    catch { return {}; }
  }

  function writeMeta(memberId, patch){
    const cur = readMeta(memberId);
    const next = { ...cur, ...patch };
    try { localStorage.setItem(metaKey(memberId), JSON.stringify(next)); } catch {}
    return next;
  }


  function escapeHtml(str) {
    return String(str ?? "").replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll('"', "&quot;").replaceAll("'", "&#039;");
  }

  function escapeAttr(str) {
    return String(str ?? "").replaceAll("&", "&amp;").replaceAll('"', "&quot;").replaceAll("'", "&#039;").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
  }

  window.reloadInternTab = function () {
    S.internData = [];
    S.internFiltered = [];
    S.internStartingData = [];
    S.internEndingData = [];
    window.loadInternTab(true);
  };

  window.clearInternFilters = function () {
    const searchInput = document.getElementById("internSearch");
    if (searchInput) searchInput.value = "";
    S.selectedPosition = "";
    const selectedText = document.getElementById("selectedPositionText");
    if (selectedText) selectedText.textContent = "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
    const dropdownItems = document.getElementById("positionDropdownItems");
    if (dropdownItems) dropdownItems.classList.remove("open");
    window.filterInterns();
  };

  window.togglePositionDropdown = function () {
    const items = document.getElementById("positionDropdownItems");
    if (items) items.classList.toggle("open");
  };

  window.selectPosition = function (value, label) {
    S.selectedPosition = value || "";
    const t = document.getElementById("selectedPositionText");
    if (t) t.textContent = label || "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
    const items = document.getElementById("positionDropdownItems");
    if (items) items.classList.remove("open");
    window.filterInterns();
  };

  window.updatePositionDropdown = function () {
    const items = document.getElementById("positionDropdownItems");
    if (!items) return;
    let html = '<div class="dd-item-intern" onclick="selectPosition(\'\', \'‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\')">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>';
    (S.positions || []).forEach(function (pos) {
      const escaped = escapeAttr(pos);
      html += '<div class="dd-item-intern" onclick="selectPosition(\'' + escaped + '\', \'' + escaped + '\')">' + escapeHtml(pos) + '</div>';
    });
    items.innerHTML = html;
  };

  document.addEventListener("click", function (e) {
    const dd = document.getElementById("positionDropdownToggle");
    const items = document.getElementById("positionDropdownItems");
    if (!dd || !items) return;
    if (e.target && e.target.closest && e.target.closest("#positionDropdownToggle")) return;
    const container = dd.closest(".custom-dropdown-intern");
    if (container && !container.contains(e.target)) items.classList.remove("open");
  }, true);

  window.filterInterns = function () {
    const input = document.getElementById("internSearch");
    const kw = (input ? input.value : "").toLowerCase().trim();
    const selectedPos = S.selectedPosition || "";
    S.internFiltered = (S.internData || []).filter(function (i) {
      const matchName = !kw || String(i.displayName || "").toLowerCase().includes(kw) || String(i.position || "").toLowerCase().includes(kw);
      const matchPos = !selectedPos || String(i.position || "") === selectedPos;
      return matchName && matchPos;
    });
    renderInternTable();
  };

  window.loadInternTab = function () {
    fetchInternMain();
    fetchStarting();
    fetchEnding();
  };

  window.toggleStartingAdd = function () {
    const form = document.getElementById("startingAddForm");
    if (!form) return;
    form.classList.toggle("show");
  };

  window.toggleEndingAdd = function () {
    const form = document.getElementById("endingAddForm");
    if (!form) return;
    form.classList.toggle("show");
  };

  window.toggleEditStarting = function () {
    S.editingStarting = !S.editingStarting;
    const btn = document.getElementById("editStartingBtn");
    const col = document.getElementById("startingActionCol");
    if (btn) {
      btn.innerHTML = S.editingStarting ? '<img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:14px;height:14px;"> ‡πÄ‡∏™‡∏£‡πá‡∏à' : '<img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;"> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
    }
    if (col) col.style.display = S.editingStarting ? "table-cell" : "none";
    renderInternStartingTable();
  };

  window.toggleEditEnding = function () {
    S.editingEnding = !S.editingEnding;
    const btn = document.getElementById("editEndingBtn");
    const col = document.getElementById("endingActionCol");
    if (btn) {
      btn.innerHTML = S.editingEnding ? '<img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:14px;height:14px;"> ‡πÄ‡∏™‡∏£‡πá‡∏à' : '<img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;"> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
    }
    if (col) col.style.display = S.editingEnding ? "table-cell" : "none";
    renderInternEndingTable();
  };

  window.toggleInternManageMode = function () {
    S.internManageMode = !S.internManageMode;
    const btn = document.getElementById("internManageBtn");
    const actionsHeader = document.getElementById("internActionsHeader");
    const actionsHeaderCol = document.getElementById("internActionsHeaderCol");
    const actionsBodyCol = document.getElementById("internActionsBodyCol");
    const addForm = document.getElementById("addInternForm");
    if (btn) btn.classList.toggle("active", S.internManageMode);
    const displayValue = S.internManageMode ? "" : "none";
    if (actionsHeader) actionsHeader.style.display = displayValue;
    if (actionsHeaderCol) actionsHeaderCol.style.display = displayValue;
    if (actionsBodyCol) actionsBodyCol.style.display = displayValue;
    if (addForm) {
      if (S.internManageMode) { addForm.classList.add("show"); updateAddInternPositionDatalist(); }
      else { addForm.classList.remove("show"); }
    }
    renderInternTable();
  };

  window.addStartingIntern = function () {
    const fullName = (document.getElementById("startingFullName")?.value || "").trim();
    const nickName = (document.getElementById("startingNickName")?.value || "").trim();
    const position = (document.getElementById("startingPosition")?.value || "").trim();
    const dateRange = (document.getElementById("startingDate")?.value || "").trim();
    if (!fullName || !position || !dateRange) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö"); return; }
    S.internStartingData.push({ fullName: fullName, nickname: nickName, position: position, dateRange: dateRange, notifyStatus: "" });
    document.getElementById("startingFullName").value = "";
    document.getElementById("startingNickName").value = "";
    document.getElementById("startingPosition").value = "";
    document.getElementById("startingDate").value = "";
    renderInternStartingTable();
    saveStartingToStore();
  };

  window.deleteStartingIntern = function (idx) {
    if (!confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
    S.internStartingData.splice(idx, 1);
    renderInternStartingTable();
    saveStartingToStore();
  };

  window.toggleStartingNotified = function (idx) {
    const row = S.internStartingData[idx];
    if (!row) return;
    row.notifyStatus = row.notifyStatus ? "" : "‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß";
    renderInternStartingTable();
    saveStartingToStore();
  };

  window.addEndingIntern = function () {
    const fullName = (document.getElementById("endingFullName")?.value || "").trim();
    const nickName = (document.getElementById("endingNickName")?.value || "").trim();
    const position = (document.getElementById("endingPosition")?.value || "").trim();
    const dateRange = (document.getElementById("endingDate")?.value || "").trim();
    if (!fullName || !position || !dateRange) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö"); return; }
    S.internEndingData.push({ fullName: fullName, nickname: nickName, position: position, dateRange: dateRange, notifyStatus: "" });
    document.getElementById("endingFullName").value = "";
    document.getElementById("endingNickName").value = "";
    document.getElementById("endingPosition").value = "";
    document.getElementById("endingDate").value = "";
    renderInternEndingTable();
    saveEndingToStore();
  };

  window.deleteEndingIntern = function (idx) {
    if (!confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
    S.internEndingData.splice(idx, 1);
    renderInternEndingTable();
    saveEndingToStore();
  };

  window.toggleEndingNotified = function (idx) {
    const row = S.internEndingData[idx];
    if (!row) return;
    row.notifyStatus = row.notifyStatus ? "" : "‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß";
    renderInternEndingTable();
    saveEndingToStore();
  };

  function renderInternTable() {
    const tbody = document.getElementById("internTableBody");
    if (!tbody) return;
    const colSpan = S.internManageMode ? 8 : 7;
    if (!S.internFiltered || !S.internFiltered.length) { tbody.innerHTML = '<tr><td colspan="' + colSpan + '" style="text-align:center;color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }
    let html = "";
    S.internFiltered.forEach(function (i) { html += rowInternHtml(i); });
    tbody.innerHTML = html;
  }

  function rowInternHtml(i) {
    const rawName = String(i.displayName || "");
    const rawPos = String(i.position || "");
    const memberId = String(i._id || "");
    const meta = i._meta || {};

    const rawStatus = String(meta.status || i.status || "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô");
    const rawNote = String(i.note || "");
    const rawFileLink = String(meta.fileLink || i.fileLink || "");

    const name = escapeHtml(rawName);
    const position = escapeHtml(rawPos);
    const note = escapeHtml(rawNote);

    const morningChecked = meta.morning ? "checked" : "";
    const noonChecked = meta.noon ? "checked" : "";

    const morning = '<input type="checkbox" ' + morningChecked +
      ' onchange="onInternCheckChange(\'' + escapeAttr(memberId) + '\', \'D\', this.checked)">';
    const noon = '<input type="checkbox" ' + noonChecked +
      ' onchange="onInternCheckChange(\'' + escapeAttr(memberId) + '\', \'E\', this.checked)">';

    const status =
      '<div class="status-dd" data-id="' + escapeAttr(memberId) + '" data-value="' + escapeAttr(rawStatus) + '">' +
        '<div class="status-selected" onclick="toggleStatusDD(this)">' +
          '<span class="status-text">' + escapeHtml(rawStatus) + '</span><span>‚ñæ</span>' +
        '</div>' +
        '<div class="status-items">' +
          '<div class="status-item" onclick="selectStatusDD(this, \'‡∏ó‡∏≥‡∏á‡∏≤‡∏ô\')">‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>' +
          '<div class="status-item" onclick="selectStatusDD(this, \'‡∏•‡∏≤\')">‡∏•‡∏≤</div>' +
          '<div class="status-item" onclick="selectStatusDD(this, \'‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô\')">‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>' +
          '<div class="status-item" onclick="selectStatusDD(this, \'‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß\')">‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>' +
        '</div>' +
      '</div>';

    let fileCell = '<span style="color:#999;">-</span>';
    if (rawFileLink.trim()) {
      const url = escapeAttr(rawFileLink.trim());
      fileCell = '<a href="' + url + '" target="_blank" rel="noopener">üìÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô</a>';
    }

    let actionCell = "";
    if (S.internManageMode) {
      actionCell =
        '<td style="text-align: center;">' +
          '<button onclick="deleteIntern(\'' + escapeAttr(memberId) + '\', \'' + escapeAttr(rawName) + '\')" ' +
            'style="background: none; border: none; cursor: pointer; color: #ef4444;">' +
            '<img src="https://img.icons8.com/?size=100&id=Gx6408t2AnyJ&format=png&color=000000" alt="Delete" style="width: 20px; height: 20px;">' +
          '</button>' +
        '</td>';
    }

    return '<tr>' +
      '<td><b>' + name + '</b></td>' +
      '<td>' + position + '</td>' +
      '<td>' + morning + '</td>' +
      '<td>' + noon + '</td>' +
      '<td>' + status + '</td>' +
      '<td>' + note + '</td>' +
      '<td>' + fileCell + '</td>' +
      actionCell +
    '</tr>';
  }

  function renderInternStartingTable() {
    const tbody = document.getElementById("internStartingBody");
    if (!tbody) return;
    const colSpan = S.editingStarting ? 6 : 5;
    if (!S.internStartingData || !S.internStartingData.length) { tbody.innerHTML = '<tr><td colspan="' + colSpan + '" style="text-align:center;color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }
    let html = "";
    S.internStartingData.forEach(function (i, idx) {
      const nick = (i.nickName ?? i.nickname ?? "");
      const date = (i.date ?? i.dateRange ?? "");
      const notified = !!(i.notified || i.notifyStatus);
      html += '<tr><td>' + escapeHtml(i.fullName || "") + '</td><td>' + escapeHtml(nick) + '</td><td>' + escapeHtml(i.position || "") + '</td><td style="text-align:center;">' + (escapeHtml(date) || "-") + '</td><td style="text-align:center;"><input type="checkbox" ' + (notified ? "checked" : "") + ' onchange="toggleStartingNotified(' + idx + ')"></td>';
      if (S.editingStarting) { html += '<td style="text-align:center;"><button class="delete-btn" onclick="deleteStartingIntern(' + idx + ')"><img src="https://img.icons8.com/?size=100&id=Gx6408t2AnyJ&format=png&color=000000" alt="trash" style="width:14px;height:14px;"></button></td>'; }
      html += '</tr>';
    });
    tbody.innerHTML = html;
  }

  function renderInternEndingTable() {
    const tbody = document.getElementById("internEndingBody");
    if (!tbody) return;
    const colSpan = S.editingEnding ? 6 : 5;
    if (!S.internEndingData || !S.internEndingData.length) { tbody.innerHTML = '<tr><td colspan="' + colSpan + '" style="text-align:center;color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>'; return; }
    let html = "";
    S.internEndingData.forEach(function (i, idx) {
      const nick = (i.nickName ?? i.nickname ?? "");
      const date = (i.date ?? i.dateRange ?? "");
      const notified = !!(i.notified || i.notifyStatus);
      html += '<tr><td>' + escapeHtml(i.fullName || "") + '</td><td>' + escapeHtml(nick) + '</td><td>' + escapeHtml(i.position || "") + '</td><td style="text-align:center;">' + (escapeHtml(date) || "-") + '</td><td style="text-align:center;"><input type="checkbox" ' + (notified ? "checked" : "") + ' onchange="toggleEndingNotified(' + idx + ')"></td>';
      if (S.editingEnding) { html += '<td style="text-align:center;"><button class="delete-btn" onclick="deleteEndingIntern(' + idx + ')"><img src="https://img.icons8.com/?size=100&id=Gx6408t2AnyJ&format=png&color=000000" alt="trash" style="width:14px;height:14px;"></button></td>'; }
      html += '</tr>';
    });
    tbody.innerHTML = html;
  }

  async function fetchInternMain() {
    try {
      const result = await window.BACKEND.getInternData(1, 100);
      const items = Array.isArray(result.items) ? result.items : [];

      // ‚úÖ ‡∏ú‡∏™‡∏≤‡∏ô meta (‡πÄ‡∏ä‡πâ‡∏≤/‡∏ö‡πà‡∏≤‡∏¢/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞) ‡∏à‡∏≤‡∏Å localStorage
      items.forEach(function (it) {
        const id = String(it?._id || "");
        it._meta = id ? readMeta(id) : {};
      });

      S.internData = items;
      S.internFiltered = S.internData.slice();

      const posSet = new Set();
      S.internData.forEach(function (i) { if (i.position) posSet.add(i.position); });
      S.positions = Array.from(posSet).sort(function (a, b) { return String(a).localeCompare(String(b), "th"); });

      window.updatePositionDropdown();
      updateAddInternPositionDatalist();
      renderInternTable();
    } catch (err) {
      console.error("‡πÇ‡∏´‡∏•‡∏î interns ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
      S.internData = [];
      S.internFiltered = [];
      S.positions = [];
      window.updatePositionDropdown();
      renderInternTable();
    }
  }

  async function fetchStarting() {
    try {
      S.internStartingData = await window.BACKEND.getInternStarting();
      renderInternStartingTable();
    } catch (e) {
      S.internStartingData = [];
      renderInternStartingTable();
    }
  }

  async function fetchEnding() {
    try {
      S.internEndingData = await window.BACKEND.getInternEnding();
      renderInternEndingTable();
    } catch (e) {
      S.internEndingData = [];
      renderInternEndingTable();
    }
  }

  async function saveStartingToStore() {
    const res = await window.BACKEND.saveInternStarting(S.internStartingData);
    if (!res?.success) console.warn("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å starting ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }

  async function saveEndingToStore() {
    const res = await window.BACKEND.saveInternEnding(S.internEndingData);
    if (!res?.success) console.warn("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ending ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }

  function updateAddInternPositionDatalist() {
    const dl = document.getElementById("addInternPositionDatalist");
    if (!dl) return;
    dl.innerHTML = "";
    (S.positions || []).forEach(function (pos) {
      const opt = document.createElement("option");
      opt.value = pos;
      dl.appendChild(opt);
    });
  }

  window.addNewInternSubmit = async function () {
    const name = (document.getElementById("newInternName")?.value || "").trim();
    const position = (document.getElementById("newInternPosition")?.value || "").trim();
    const note = (document.getElementById("newInternNote")?.value || "").trim();
    const fileLink = (document.getElementById("newInternFileLink")?.value || "").trim();
    if (!name || !position) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"); return; }
    try {
      const res = await window.BACKEND.addNewIntern(name, position, note, fileLink);
      if (res?.success) {
        document.getElementById("newInternName").value = "";
        document.getElementById("newInternPosition").value = "";
        document.getElementById("newInternNote").value = "";
        document.getElementById("newInternFileLink").value = "";
        window.reloadInternTab();
      } else {
        alert(res?.message || "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }
    } catch (err) {
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (err?.message || err));
    }
  };

  window.hideAddInternForm = function () {
    S.internManageMode = false;
    const btn = document.getElementById("internManageBtn");
    const actionsHeader = document.getElementById("internActionsHeader");
    const actionsHeaderCol = document.getElementById("internActionsHeaderCol");
    const actionsBodyCol = document.getElementById("internActionsBodyCol");
    const addForm = document.getElementById("addInternForm");
    if (btn) btn.classList.remove("active");
    if (actionsHeader) actionsHeader.style.display = "none";
    if (actionsHeaderCol) actionsHeaderCol.style.display = "none";
    if (actionsBodyCol) actionsBodyCol.style.display = "none";
    if (addForm) addForm.classList.remove("show");
    renderInternTable();
  };

  window.onInternCheckChange = async function (memberId, col, checked) {
    try {
      const res = await window.BACKEND.updateInternCheckbox(memberId, col, !!checked);
      if (!res?.success) alert(res?.message || "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    } catch (err) {
      alert(err?.message || String(err));
    }
  };

  async function onInternStatusChange(memberId, status) {
    try {
      const res = await window.BACKEND.updateInternStatus(memberId, status);
      if (!res?.success) alert(res?.message || "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    } catch (err) {
      alert(err?.message || String(err));
    }
  }

  window.toggleStatusDD = function (el) {
    const items = el ? el.nextElementSibling : null;
    if (!items) return;
    document.querySelectorAll(".status-items.open").forEach(function (other) {
      if (other !== items) other.classList.remove("open");
    });
    const willOpen = !items.classList.contains("open");
    items.classList.toggle("open");
    if (willOpen) {
      const rect = el.getBoundingClientRect();
      items.style.top = (rect.bottom + 6) + "px";
      items.style.left = rect.left + "px";
    }
  };

  window.selectStatusDD = function (el, value) {
    const wrap = el ? el.closest(".status-dd") : null;
    if (!wrap) return;
    const memberId = wrap.dataset.id;
    wrap.dataset.value = value;
    const textEl = wrap.querySelector(".status-text");
    if (textEl) textEl.textContent = value;
    const items = wrap.querySelector(".status-items");
    if (items) items.classList.remove("open");
    onInternStatusChange(memberId, value);
  };

  document.addEventListener("click", function (e) {
    document.querySelectorAll(".status-items.open").forEach(function (items) {
      if (!items.parentElement.contains(e.target)) items.classList.remove("open");
    });
  }, true);

  window.deleteIntern = async function (memberId, name) {
    if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö "' + name + '" ?')) return;
    try {
      const res = await window.BACKEND.deleteIntern(memberId);
      if (res?.success) window.reloadInternTab();
      else alert(res?.message || "‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    } catch (err) {
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + (err?.message || err));
    }
  };

  document.addEventListener("DOMContentLoaded", function () {
    window.loadInternTab();
  });
})();

/* Scroll sync */
(function () {
  function bindOneTableWrap(wrap) {
    const head = wrap.querySelector(".table-header-wrapper");
    const body = wrap.querySelector(".table-body-wrapper");
    if (!head || !body) return;
    if (body.__boundScrollSync) return;
    body.__boundScrollSync = true;
    const sync = () => { head.scrollLeft = body.scrollLeft; };
    body.addEventListener("scroll", () => {
      requestAnimationFrame(sync);
      document.querySelectorAll(".status-items.open").forEach(function (items) {
        items.classList.remove("open");
      });
    }, { passive: true });
    head.addEventListener("scroll", () => {
      if (body.scrollLeft !== head.scrollLeft) body.scrollLeft = head.scrollLeft;
    }, { passive: true });
    sync();
  }

  function bindAll() {
    document.querySelectorAll(".table-wrap").forEach(bindOneTableWrap);
  }

  document.addEventListener("DOMContentLoaded", bindAll);
  window.addEventListener("load", bindAll);
  window.addEventListener("resize", bindAll);
  const mo = new MutationObserver(() => bindAll());
  mo.observe(document.documentElement, { childList: true, subtree: true });
})();
  </script>

</body>
</html>
