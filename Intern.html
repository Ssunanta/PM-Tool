<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intern Management</title>

  <style>
    :root {
      --bg: #f3f3f3;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 10px 28px rgba(15, 23, 42, .10);
      --shadow2: 0 4px 12px rgba(15, 23, 42, .08);
      --radius: 16px;
      --radius2: 12px;
      --btn: #111;
      --btnHover: #000;
      --purple: #8b5cf6;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      -webkit-text-size-adjust: 100%;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto 20px;
      padding: 22px;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 24px;
      font-weight: 900;
      letter-spacing: .2px;
      margin-bottom: 14px;
    }

    .title .dot {
      width: 14px;
      height: 14px;
      border-radius: 5px;
      background: var(--purple);
      box-shadow: 0 6px 16px rgba(139, 92, 246, .35);
      display: inline-block;
    }

    /* =========================================================
     ✅ CONTROLS ROW
     ========================================================= */

.intern-controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
      margin-bottom: 16px;

      padding: 14px;
      background: #f8fafc;
      border: 1px solid rgba(15, 23, 42, .08);
      border-radius: 16px;
      box-shadow: var(--shadow2);
    }

    .intern-controls input {

      height: 44px;
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 14px;
      font-weight: 900;
      box-shadow: 0 6px 16px rgba(15, 23, 42, .06);

  flex: 1 1 auto;
  min-width: 200px;
    }

    .intern-controls input::placeholder {
      color: #94a3b8;
      font-weight: 900;
    }

    .intern-controls input:focus {
      outline: none;
      border-color: #111;
      box-shadow: 0 10px 22px rgba(15, 23, 42, .10);
    }

    .intern-controls button {
      height: 44px;
      padding: 0 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #fff;

      cursor: pointer;
      font-size: 14px;
      font-weight: 900;
      box-shadow: 0 6px 16px rgba(15, 23, 42, .06);
      transition: 0.2s;
      white-space: nowrap;
  flex: 0 1 auto;
    min-width: fit-content;

      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .intern-controls button:hover {
      border-color: #cbd5e1;
      background: #fafafa;
    }

    /* ปุ่ม เพิ่ม/ลดงาน */
    .manage-btn {
      height: 44px;
      padding: 0 18px;
      border-radius: 14px;
      border: none;
      background: var(--btn);
      color: #fff;
      font-size: 14px;
      font-weight: 900;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: var(--shadow2);
      white-space: nowrap;
      opacity: 1;
  flex: 0 1 auto;
  min-width: fit-content;
    }

    button.manage-btn {
      -webkit-appearance: none;
      appearance: none;
      border: none;
      outline: none;
      -webkit-text-fill-color: #fff;
      text-rendering: geometricPrecision;
      background-color: var(--btn);
      color: #fff;
    }

    button.manage-btn span {
      color: #fff;
      -webkit-text-fill-color: #fff;
      font-weight: inherit;
    }

    .manage-btn:hover {
      background: var(--btnHover);
    }

    .manage-btn.active {
      background: #10b981;
    }

    /* ✅ FIX: ให้ manage-btn ชนะกฎของ .intern-controls button */
    .intern-controls .manage-btn {
      background: var(--btn);
      color: #fff;
      border: none;
    }

    .intern-controls .manage-btn:hover {
      background: var(--btnHover);
      color: #fff;
      border: none;
    }

    .intern-controls .manage-btn.active {
      background: #10b981;
      color: #fff;
    }

    /* ปุ่มรีโหลด */
    .intern-controls button:last-child {
      background: #fff;
      border: 1px solid rgba(15, 23, 42, .16);
    }

    .intern-controls button:last-child:hover {
      background: #f1f5f9;
      border-color: rgba(15, 23, 42, .22);
    }

    /* =========================================================
     ✅ CUSTOM DROPDOWN (ตำแหน่ง) - ปรับให้ไม่กินขวา + ตัดบรรทัดสวยขึ้น
     ========================================================= */

    .intern-controls select {
      display: none !important;
    }

    /* ✅ ล็อกความกว้าง dropdown ไม่ให้ขยายกินทางขวา */
.custom-dropdown-intern {
  position: relative;
  flex: 0 1 auto;
  width: 260px;
  min-width: 180px;
  max-width: 260px;
}
    .dropdown-selected-intern {
      padding: 12px 14px;
      border-radius: 14px;
      background: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border: 1px solid var(--border);
      font-size: 14px;
      font-weight: 900;
      box-shadow: var(--shadow2);
      width: 100%;
      height: 44px;
      gap: 10px;
    }

    /* ✅ ชื่อที่เลือก ให้ไม่ดันความกว้าง (โชว์ ... แทน) */
    #selectedPositionText {
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: calc(100% - 24px);
    }

    .dropdown-selected-intern:hover {
      border-color: #cbd5e1;
    }

    .dropdown-items-intern {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: #f1f5f9;
      border: 1px solid var(--border);
      border-radius: 16px;
      margin-top: 8px;
      max-height: 360px;
      overflow-y: auto;
      display: none;
      z-index: 100;
      padding: 10px;
      box-shadow: var(--shadow);
    }

    .dropdown-items-intern.open {
      display: block;
    }

    /* ✅ ตัดบรรทัดให้ดูสวย: ไม่แยกคำมั่ว ๆ แต่ยังกันล้นได้ */
    .dd-item-intern {
      display: block;
      padding: 12px 12px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 15px;
      color: #111;
      border: 1px solid rgba(15, 23, 42, .06);
      background: #fff;
      font-weight: 900;

      white-space: normal;
      word-break: normal;
      /* ไม่บังคับฉีกคำ */
      overflow-wrap: anywhere;
      /* กันล้นกรณีคำยาวมากจริงๆ */
      line-height: 1.25;
    }

    .dd-item-intern+.dd-item-intern {
      margin-top: 8px;
    }

    .dd-item-intern:hover {
      background: #fafafa;
      border-color: rgba(15, 23, 42, .12);
    }

    /* =========================================================
     ✅ STATUS DROPDOWN (custom)
     ========================================================= */
    .status-dd {
      position: relative;
      display: inline-block;
      width: 140px;
    }

    .status-selected {
      height: 36px;
      padding: 0 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      cursor: pointer;
      box-shadow: var(--shadow2);
      font-size: 13px;
      font-weight: 900;
      user-select: none;
    }

    .status-selected:hover {
      border-color: #cbd5e1;
      background: #fafafa;
    }

.status-items {
  position: fixed;
  margin-top: 6px;
  background: #f1f5f9;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 8px;
  display: none;
  z-index: 250;
  box-shadow: var(--shadow);
  min-width: 140px;
}

    .status-items.open {
      display: block;
    }

    .status-item {
      padding: 10px 10px;
      border-radius: 12px;
      background: #fff;
      cursor: pointer;
      text-align: center;
      border: 1px solid rgba(15, 23, 42, .06);
      font-size: 13px;
      font-weight: 900;
    }

    .status-item+.status-item {
      margin-top: 8px;
    }

    .status-item:hover {
      background: #fafafa;
      border-color: rgba(15, 23, 42, .12);
    }

    /* =========================================================
     TABLE WRAPPER
     ========================================================= */
    .table-wrap {
      margin-top: 8px;
      border: 1px solid var(--border);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: var(--shadow2);
      background: #fff;
      display: flex;
      flex-direction: column;
      max-height: 100vh;
    }

    /* ✅ ทำให้ header เลื่อนตาม body ได้ */
    .table-header-wrapper {
      overflow-x: auto;
      /* สำคัญ: ต้องเลื่อนได้ */
      overflow-y: hidden;
      flex-shrink: 0;
      scrollbar-width: none;
      /* Firefox ซ่อน scrollbar */
    }

    .table-header-wrapper::-webkit-scrollbar {
      height: 0;
      /* Safari/Chrome ซ่อน scrollbar */
    }

    /* ตัวเลื่อนจริง (ให้ user เลื่อนที่ body) */
    .table-body-wrapper {
      overflow-y: auto;
      overflow-x: auto;
      flex: 1;
      -webkit-overflow-scrolling: touch;
    }

    /* กันบางเครื่องทำให้หน้าเว็บล้นแนวนอนโดยไม่ตั้งใจ */
    body {
      overflow-x: hidden;
    }


    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      table-layout: fixed;
      min-width: 1020px;
    }

    table thead th {
      background: #f8fafc;
      font-weight: 900;
      color: #111827;
      border-bottom: 1px solid var(--border);
      padding: 14px;
      font-size: 14px;
      text-align: center;
      vertical-align: middle;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    table tbody td {
      padding: 14px;
      font-size: 14px;
      border-bottom: 1px solid rgba(15, 23, 42, .06);
      text-align: center;
      vertical-align: middle;
      color: #333;
    }

    table tbody tr:nth-child(odd) {
      background: #fff;
    }

    table tbody tr:nth-child(even) {
      background: #fcfcfd;
    }

    table tbody tr:hover {
      background: #f7fafc;
    }

    table input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--btn);
    }

    /* (ยังคงไว้ เผื่อส่วนอื่นยังใช้ select) */
    table select {
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 13px;
      font-weight: 900;
      cursor: pointer;
      background: #fff;
      box-shadow: var(--shadow2);
    }

    table select:focus {
      outline: none;
      border-color: var(--btn);
      box-shadow: 0 10px 22px rgba(15, 23, 42, .10);
    }

    .delete-btn {
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(239, 68, 68, .35);
      background: #fff1f2;
      color: #b91c1c;
      cursor: pointer;
      font-size: 12px;
      font-weight: 900;
      transition: 0.2s;
    }

    .delete-btn:hover {
      filter: brightness(.95);
    }

    a {
      color: #1a73e8;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .loading {
      text-align: center;
      padding: 50px;
      color: #999;
      font-weight: 900;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 18px;
      font-weight: 900;
      margin: 20px 0 16px 0;
      color: #111827;
      letter-spacing: .2px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .h3-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .section-header button {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
      font-size: 13px;
      font-weight: 900;
      box-shadow: var(--shadow2);
      transition: 0.2s;
      white-space: nowrap;
    }

    .section-header button:hover {
      border-color: #cbd5e1;
      background: #fafafa;
    }

    #startingAddForm,
    #endingAddForm,
    #addInternForm {
      display: none;
      gap: 10px;
      align-items: center;
      margin-top: 14px;
      padding: 14px;
      background: #f8fafc;
      border-radius: 12px;
      flex-wrap: wrap;
      border: 1px solid rgba(15, 23, 42, .08);
    }

    #startingAddForm.show,
    #endingAddForm.show,
    #addInternForm.show {
      display: flex;
    }

    #startingAddForm input,
    #endingAddForm input,
    #addInternForm input {
      height: 44px;
      padding: 0 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 13px;
      font-weight: 900;
      box-shadow: var(--shadow2);
      flex: 1;
      min-width: 160px;
      background: #fff;
    }

    #startingAddForm input:focus,
    #endingAddForm input:focus,
    #addInternForm input:focus {
      outline: none;
      border-color: var(--btn);
      box-shadow: 0 10px 22px rgba(15, 23, 42, .10);
    }

    #startingAddForm button,
    #endingAddForm button,
    #addInternForm button {
      height: 44px;
      padding: 0 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
      font-size: 13px;
      font-weight: 900;
      box-shadow: var(--shadow2);
      transition: 0.2s;
      white-space: nowrap;
    }

    #startingAddForm button:hover,
    #endingAddForm button:hover,
    #addInternForm button:hover {
      background: #f7f7f7;
      border-color: #cbd5e1;
    }

/* =========================================================
 RESPONSIVE
 ========================================================= */

/* Tablet landscape & smaller desktop (1024px - 1200px) */
@media (max-width: 1200px) {
  .container {
    padding: 20px;
  }

  .intern-controls {
    flex-wrap: wrap;
  }

  .intern-controls input {
    flex: 1 1 250px;
    min-width: 200px;
  }

  .custom-dropdown-intern {
    width: 240px;
    min-width: 240px;
    max-width: 240px;
  }

  #internManageBtn,
  .intern-controls button:last-child {
    flex: 0 0 auto;
  }

  table {
    min-width: 1000px;
  }
}

/* Tablet portrait (768px - 920px) */
@media (max-width: 920px) {
  .container {
    padding: 18px;
    margin: 0 auto 18px;
  }

  .title {
    font-size: 22px;
  }

  .section-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .h3-actions {
    width: 100%;
    justify-content: flex-start;
  }

  .intern-controls {
    padding: 12px;
  }

  table th,
  table td {
    padding: 12px 10px;
    font-size: 13px;
  }

  .table-wrap {
    max-height: 500px;
  }
}

/* iPad & small tablets (640px - 768px) */
@media (max-width: 768px) {
  .container {
    padding: 16px;
    border-radius: 14px;
  }

  .title {
    font-size: 20px;
    margin-bottom: 12px;
  }

  .intern-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .intern-controls input {
    grid-column: 1 / -1;
    width: 100%;
    min-width: 0;
    height: 48px;
    font-size: 15px;
  }

  .custom-dropdown-intern {
    width: 100%;
    min-width: 0;
    max-width: none;
  }

  .dropdown-selected-intern {
    height: 48px;
    font-size: 15px;
  }

  #internManageBtn {
    width: 100%;
    height: 48px;
    font-size: 15px;
  }

  .intern-controls button:last-child {
    width: 100%;
    height: 48px;
    font-size: 15px;
  }

  .status-dd {
    width: 130px;
  }

  .table-wrap {
    max-height: 450px;
  }

  #startingAddForm,
  #endingAddForm,
  #addInternForm {
    padding: 12px;
    gap: 8px;
  }

  #startingAddForm input,
  #endingAddForm input,
  #addInternForm input {
    min-width: 140px;
    height: 48px;
    font-size: 15px;
  }

  #startingAddForm button,
  #endingAddForm button,
  #addInternForm button {
    height: 48px;
    font-size: 15px;
  }

  .section-header button {
    height: 44px;
    font-size: 14px;
    padding: 0 16px;
  }
}

/* =====================================================================
   MOBILE & TABLET RESPONSIVE - INTERN MANAGEMENT
   ===================================================================== */

/* Mobile & Tablet (768px and below) */
@media (max-width: 768px) {
  * {
    -webkit-tap-highlight-color: transparent;
  }

  body {
    font-size: 16px !important;
  }

  /* ========== CONTAINER ========== */
  .container {
    max-width: 100% !important;
    margin: 0 auto 18px !important;
    padding: 16px !important;
    background: var(--card) !important;
    border-radius: 14px !important;
    box-shadow: var(--shadow2) !important;
  }

  /* ========== TITLE ========== */
  .title {
    font-size: 22px !important;
    font-weight: 900 !important;
    margin-bottom: 16px !important;
    gap: 12px !important;
  }

  .title img {
    width: 26px !important;
    height: 26px !important;
  }

  .title .dot {
    width: 14px !important;
    height: 14px !important;
    box-shadow: 0 6px 16px rgba(139, 92, 246, .35) !important;
  }

  /* ========== CONTROLS ROW ========== */
  .intern-controls {
    display: flex !important;
    flex-direction: column !important;
    gap: 12px !important;
    padding: 14px !important;
    background: #f8fafc !important;
    border: 1px solid rgba(15, 23, 42, .08) !important;
    border-radius: 16px !important;
    margin-bottom: 16px !important;
  }

  .intern-controls input {
    width: 100% !important;
    height: 50px !important;
    padding: 0 16px !important;
    border: 1px solid var(--border) !important;
    border-radius: 14px !important;
    font-size: 16px !important;
    font-weight: 900 !important;
    background: #fff !important;
    box-shadow: var(--shadow2) !important;
    order: 1 !important;
  }

  .intern-controls input::placeholder {
    color: #94a3b8 !important;
    font-weight: 900 !important;
  }

  .intern-controls input:focus {
    outline: none !important;
    border-color: #111 !important;
    box-shadow: 0 10px 22px rgba(15, 23, 42, .10) !important;
  }

  /* ========== DROPDOWN (ตำแหน่ง) ========== */
  .custom-dropdown-intern {
    width: 100% !important;
    min-width: 0 !important;
    max-width: none !important;
    order: 2 !important;
  }

  .dropdown-selected-intern {
    padding: 0 16px !important;
    border-radius: 14px !important;
    border: 1px solid var(--border) !important;
    height: 50px !important;
    font-size: 16px !important;
    font-weight: 900 !important;
    background: #fff !important;
    box-shadow: var(--shadow2) !important;
    width: 100% !important;
  }

  .dropdown-items-intern {
    max-height: 280px !important;
    border-radius: 16px !important;
    margin-top: 8px !important;
    box-shadow: var(--shadow) !important;
    padding: 10px !important;
  }

  .dd-item-intern {
    padding: 14px 12px !important;
    border-radius: 14px !important;
    font-size: 15px !important;
    font-weight: 900 !important;
    border: 1px solid rgba(15, 23, 42, .06) !important;
  }

  .dd-item-intern + .dd-item-intern {
    margin-top: 8px !important;
  }

  /* ========== BUTTONS ========== */
  .intern-controls button {
    width: 100% !important;
    height: 50px !important;
    padding: 0 16px !important;
    border-radius: 14px !important;
    border: 1px solid var(--border) !important;
    font-size: 16px !important;
    font-weight: 900 !important;
    background: #fff !important;
    box-shadow: var(--shadow2) !important;
    cursor: pointer !important;
    transition: 0.2s !important;
    white-space: nowrap !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
  }

  .intern-controls button:active {
    background: #f5f5f5 !important;
    border-color: #cbd5e1 !important;
  }

  .manage-btn {
    width: 100% !important;
    height: 50px !important;
    padding: 0 16px !important;
    border-radius: 14px !important;
    border: none !important;
    background: var(--btn) !important;
    color: #fff !important;
    font-size: 16px !important;
    font-weight: 900 !important;
    cursor: pointer !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
    box-shadow: var(--shadow2) !important;
    white-space: nowrap !important;
    order: 3 !important;
  }

  .manage-btn:active {
    background: var(--btnHover) !important;
  }

  .manage-btn.active {
    background: #10b981 !important;
  }

  .intern-controls button:last-child {
    order: 4 !important;
  }

  /* ========== TABLE ========== */
  .table-wrap {
    max-height: 450px !important;
    border-radius: 16px !important;
    overflow: hidden !important;
    margin-bottom: 16px !important;
    box-shadow: var(--shadow2) !important;
  }

  .table-header-wrapper {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    flex-shrink: 0 !important;
    scrollbar-width: none !important;
  }

  .table-header-wrapper::-webkit-scrollbar {
    height: 0 !important;
  }

  .table-body-wrapper {
    overflow-y: auto !important;
    overflow-x: auto !important;
    flex: 1 !important;
    -webkit-overflow-scrolling: touch !important;
  }

  table {
    width: 100% !important;
    table-layout: fixed !important;
    min-width: 900px !important;
  }

  table thead th {
    background: #f8fafc !important;
    font-weight: 900 !important;
    color: #111827 !important;
    border-bottom: 1px solid var(--border) !important;
    padding: 12px 10px !important;
    font-size: 13px !important;
    text-align: center !important;
    vertical-align: middle !important;
    position: sticky !important;
    top: 0 !important;
    z-index: 10 !important;
  }

  table tbody td {
    padding: 12px 10px !important;
    font-size: 13px !important;
    border-bottom: 1px solid rgba(15, 23, 42, .06) !important;
    text-align: center !important;
    vertical-align: middle !important;
    color: #333 !important;
  }

  table tbody tr:nth-child(odd) {
    background: #fff !important;
  }

  table tbody tr:nth-child(even) {
    background: #fcfcfd !important;
  }

  table input[type="checkbox"] {
    width: 20px !important;
    height: 20px !important;
    cursor: pointer !important;
    accent-color: var(--btn) !important;
  }

  table input[type="text"] {
    width: 100% !important;
    height: 44px !important;
    padding: 0 12px !important;
    border: 1px solid #cbd5e1 !important;
    border-radius: 10px !important;
    font-size: 14px !important;
    font-weight: 900 !important;
    box-sizing: border-box !important;
  }

  table input[type="text"]:focus {
    outline: none !important;
    border-color: var(--btn) !important;
    box-shadow: 0 10px 22px rgba(15, 23, 42, .10) !important;
  }

  table select {
    padding: 6px 10px !important;
    border: 1px solid var(--border) !important;
    border-radius: 10px !important;
    font-size: 13px !important;
    font-weight: 900 !important;
    cursor: pointer !important;
    background: #fff !important;
    box-shadow: var(--shadow2) !important;
  }

  /* ========== STATUS DROPDOWN ========== */
  .status-dd {
    position: relative !important;
    width: 130px !important;
    display: inline-block !important;
  }

  .status-selected {
    height: 36px !important;
    padding: 0 12px !important;
    border-radius: 12px !important;
    border: 1px solid var(--border) !important;
    background: #fff !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 8px !important;
    cursor: pointer !important;
    box-shadow: var(--shadow2) !important;
    font-size: 13px !important;
    font-weight: 900 !important;
    user-select: none !important;
  }

  .status-items {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    width: 100% !important;
    margin-top: 6px !important;
    background: #f1f5f9 !important;
    border: 1px solid var(--border) !important;
    border-radius: 14px !important;
    padding: 8px !important;
    display: none !important;
    z-index: 250 !important;
    box-shadow: var(--shadow) !important;
  }

  .status-items.open {
    display: block !important;
  }

  .status-item {
    padding: 10px 10px !important;
    border-radius: 12px !important;
    background: #fff !important;
    cursor: pointer !important;
    text-align: center !important;
    border: 1px solid rgba(15, 23, 42, .06) !important;
    font-size: 13px !important;
    font-weight: 900 !important;
  }

  .status-item + .status-item {
    margin-top: 8px !important;
  }

  /* ========== SECTION HEADER ========== */
  .section-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: flex-start !important;
    font-size: 18px !important;
    font-weight: 900 !important;
    margin: 20px 0 14px 0 !important;
    color: #111827 !important;
    gap: 12px !important;
    flex-wrap: wrap !important;
  }

  .section-header img {
    width: 22px !important;
    height: 22px !important;
  }

  .h3-actions {
    display: flex !important;
    gap: 10px !important;
    flex-wrap: wrap !important;
    width: 100% !important;
  }

  .section-header button {
    flex: 1 !important;
    min-width: 140px !important;
    padding: 0 14px !important;
    height: 44px !important;
    border-radius: 12px !important;
    border: 1px solid var(--border) !important;
    background: #fff !important;
    cursor: pointer !important;
    font-size: 14px !important;
    font-weight: 900 !important;
    box-shadow: var(--shadow2) !important;
    transition: 0.2s !important;
    white-space: nowrap !important;
  }

  .section-header button:active {
    background: #f5f5f5 !important;
    border-color: #cbd5e1 !important;
  }

  /* ========== ADD FORMS ========== */
  #startingAddForm,
  #endingAddForm,
  #addInternForm {
    display: none !important;
    flex-direction: column !important;
    gap: 10px !important;
    margin-top: 14px !important;
    padding: 14px !important;
    background: #f8fafc !important;
    border-radius: 14px !important;
    border: 1px solid rgba(15, 23, 42, .08) !important;
  }

  #startingAddForm.show,
  #endingAddForm.show,
  #addInternForm.show {
    display: flex !important;
  }

  #startingAddForm input,
  #endingAddForm input,
  #addInternForm input {
    width: 100% !important;
    height: 50px !important;
    padding: 0 16px !important;
    border: 1px solid var(--border) !important;
    border-radius: 12px !important;
    font-size: 16px !important;
    font-weight: 900 !important;
    box-shadow: var(--shadow2) !important;
    background: #fff !important;
    box-sizing: border-box !important;
  }

  #startingAddForm input:focus,
  #endingAddForm input:focus,
  #addInternForm input:focus {
    outline: none !important;
    border-color: var(--btn) !important;
    box-shadow: 0 10px 22px rgba(15, 23, 42, .10) !important;
  }

  #startingAddForm button,
  #endingAddForm button,
  #addInternForm button {
    width: 100% !important;
    height: 50px !important;
    padding: 0 16px !important;
    border-radius: 12px !important;
    border: 1px solid var(--border) !important;
    background: #fff !important;
    cursor: pointer !important;
    font-size: 16px !important;
    font-weight: 900 !important;
    box-shadow: var(--shadow2) !important;
    transition: 0.2s !important;
    white-space: nowrap !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
  }

  #startingAddForm button:active,
  #endingAddForm button:active,
  #addInternForm button:active {
    background: #f5f5f5 !important;
    border-color: #cbd5e1 !important;
  }

  /* ========== DELETE BUTTON ========== */
  .delete-btn {
    padding: 8px 12px !important;
    border-radius: 10px !important;
    border: 1px solid rgba(239, 68, 68, .35) !important;
    background: #fff1f2 !important;
    color: #b91c1c !important;
    cursor: pointer !important;
    font-size: 12px !important;
    font-weight: 900 !important;
    transition: 0.2s !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 6px !important;
  }

  .delete-btn:active {
    filter: brightness(.95) !important;
  }

  /* ========== UTILITY ========== */
  .loading {
    text-align: center !important;
    padding: 30px 20px !important;
    color: #999 !important;
    font-weight: 900 !important;
  }

  a {
    color: #1a73e8 !important;
    text-decoration: none !important;
    word-break: break-word !important;
  }

  a:active {
    opacity: 0.8 !important;
  }
}

/* Extra Small Screens (480px and below) */
@media (max-width: 480px) {
  .container {
    padding: 14px !important;
    margin: 0 auto 16px !important;
  }

  .title {
    font-size: 20px !important;
    margin-bottom: 14px !important;
  }

  .title img {
    width: 24px !important;
    height: 24px !important;
  }

  .intern-controls {
    padding: 12px !important;
    gap: 10px !important;
  }

  .intern-controls input {
    height: 52px !important;
    font-size: 17px !important;
  }

  .intern-controls button,
  .manage-btn {
    height: 52px !important;
    font-size: 17px !important;
  }

  .section-header {
    font-size: 17px !important;
    margin: 18px 0 12px 0 !important;
  }

  .section-header button {
    min-width: 120px !important;
    height: 46px !important;
    font-size: 15px !important;
  }

  #startingAddForm,
  #endingAddForm,
  #addInternForm {
    padding: 12px !important;
    gap: 8px !important;
  }

  #startingAddForm input,
  #endingAddForm input,
  #addInternForm input {
    height: 52px !important;
    font-size: 17px !important;
  }

  #startingAddForm button,
  #endingAddForm button,
  #addInternForm button {
    height: 52px !important;
    font-size: 17px !important;
  }

  table {
    min-width: 880px !important;
  }

  table thead th {
    font-size: 12px !important;
    padding: 10px 6px !important;
  }

  table tbody td {
    padding: 10px 6px !important;
    font-size: 12px !important;
  }

  table input[type="checkbox"] {
    width: 22px !important;
    height: 22px !important;
  }
}

/* Very Small Screens (360px and below) */
@media (max-width: 360px) {
  .container {
    padding: 12px !important;
  }

  .title {
    font-size: 18px !important;
  }

  table {
    min-width: 850px !important;
  }

  table thead th {
    padding: 8px 4px !important;
    font-size: 11px !important;
  }

  table tbody td {
    padding: 8px 4px !important;
    font-size: 11px !important;
  }
}

/* Landscape Mode */
@media (max-width: 900px) and (orientation: landscape) {
  .table-wrap {
    max-height: 350px !important;
  }

  .intern-controls {
    grid-template-columns: 1fr 1fr !important;
  }

  .intern-controls button {
    grid-column: auto !important;
  }
}
  </style>

</head>

<body>

<!-- MAIN INTERN DATA -->
  <div class="container">
    <div class="title">
      <img src="https://img.icons8.com/?size=100&id=wNJfNKpLXXlt&format=png&color=000000" alt="users" style="width:24px;height:24px;">
      รายชื่อเด็กฝึกงาน
    </div>

    <div class="intern-controls">
      <input type="text" id="internSearch" placeholder="ค้นหาชื่อ" oninput="filterInterns()" />

      <button id="internManageBtn" class="manage-btn" onclick="toggleInternManageMode()">
        <img src="https://img.icons8.com/?size=100&id=bDKqvw7V0ANQ&format=png&color=000000" alt="plus" style="width:16px;height:16px;">
        <span>เพิ่ม/ลดรายชื่อ</span>
      </button>

      <div class="custom-dropdown-intern">
        <div class="dropdown-selected-intern" id="positionDropdownToggle" onclick="togglePositionDropdown()">
          <span id="selectedPositionText">ตำแหน่งทั้งหมด</span>
          <span>▾</span>
        </div>
        <div class="dropdown-items-intern" id="positionDropdownItems">
          <div class="dd-item-intern" onclick="selectPosition('', 'ตำแหน่งทั้งหมด')">ตำแหน่งทั้งหมด</div>
        </div>
      </div>

      <button onclick="clearInternFilters()">
  ล้างตัวกรอง
</button>
    </div>

    <div class="table-wrap">
<div class="table-header-wrapper">
  <table>
<!-- Table Header -->
<colgroup>
  <col style="width:120px;">   <!-- ชื่อ -->
  <col style="width:150px;">   <!-- ตำแหน่ง -->
  <col style="width:70px;">    <!-- เช้า -->
  <col style="width:70px;">    <!-- บ่าย -->
  <col style="width:140px;">   <!-- สถานะ -->
  <col style="width:200px;">   <!-- หมายเหตุ -->
  <col style="width:180px;">   <!-- ไฟล์อัปเดตงาน -->
  <col id="internActionsHeaderCol" style="width:100px; display:none;">   <!-- ลบ -->
</colgroup>
    <thead>
      <tr>
        <th>ชื่อ</th>
        <th>ตำแหน่ง</th>
        <th>เช้า</th>
        <th>บ่าย</th>
        <th>สถานะ</th>
        <th>หมายเหตุ</th>
        <th>ไฟล์อัปเดตงาน</th>
        <th id="internActionsHeader" style="display:none;">ลบ</th>
      </tr>
    </thead>
  </table>
</div>

<div class="table-body-wrapper">
  <table>
<colgroup>
  <col style="width:120px;">   <!-- ชื่อ -->
  <col style="width:150px;">   <!-- ตำแหน่ง -->
  <col style="width:70px;">    <!-- เช้า -->
  <col style="width:70px;">    <!-- บ่าย -->
  <col style="width:140px;">   <!-- สถานะ -->
  <col style="width:200px;">   <!-- หมายเหตุ -->
  <col style="width:180px;">   <!-- ไฟล์อัปเดตงาน -->
  <col id="internActionsBodyCol" style="width:100px; display:none;">   <!-- ลบ -->
</colgroup>

          <tbody id="internTableBody">
            <tr>
              <td colspan="7" class="loading">กำลังโหลด...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ✅ เพิ่มฟอร์ม inline สำหรับเพิ่มเด็กฝึกงาน -->
    <div id="addInternForm">
      <input type="text" id="newInternName" placeholder="ชื่อเด็กฝึกงาน">
      <input type="text" id="newInternPosition" placeholder="ตำแหน่ง" list="addInternPositionDatalist">
      <datalist id="addInternPositionDatalist"></datalist>
      <input type="text" id="newInternNote" placeholder="หมายเหตุ (ไม่บังคับ)">
      <input type="text" id="newInternFileLink" placeholder="ลิงก์ไฟล์อัปเดตงาน (ไม่บังคับ)">
      <button onclick="addNewInternSubmit()">
        <img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:16px;height:16px;">
        เพิ่ม
      </button>
      <button onclick="hideAddInternForm()">
        <img src="https://img.icons8.com/?size=100&id=QlMnqMXDMws3&format=png&color=000000" alt="close" style="width:16px;height:16px;">
        ยกเลิก
      </button>
    </div>

  </div>

  <!-- STARTING -->
  <div class="container">
    <div class="section-header">
      <span>
        <img src="https://img.icons8.com/?size=100&id=WO3eRAu5RSGP&format=png&color=000000" alt="sprout" style="width:20px;height:20px;">
        นักศึกษาฝึกงานที่กำลังเริ่มงาน
      </span>
      <div class="h3-actions">
        <button onclick="toggleStartingAdd()">
          <img src="https://img.icons8.com/?size=100&id=XpyLr4ervzGM&format=png&color=000000" alt="add" style="width:14px;height:14px;">
          เพิ่มชื่อ
        </button>
        <button id="editStartingBtn" onclick="toggleEditStarting()">
          <img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;">
          แก้ไข
        </button>
      </div>
    </div>

    <div class="table-wrap">
      <div class="table-header-wrapper">
        <table>
          <thead>
            <tr>
              <th>ชื่อจริง/นามสกุล</th>
              <th>ชื่อเล่น</th>
              <th>ตำแหน่ง</th>
              <th>วันที่</th>
              <th>แจ้ง</th>
              <th id="startingActionCol" style="display:none;">ลบ</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="table-body-wrapper">
        <table>
          <tbody id="internStartingBody">
            <tr>
              <td colspan="5" class="loading">กำลังโหลด...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="startingAddForm">
      <input type="text" id="startingFullName" placeholder="ชื่อจริง/นามสกุล">
      <input type="text" id="startingNickName" placeholder="ชื่อเล่น">
      <input type="text" id="startingPosition" placeholder="ตำแหน่ง">
      <input type="text" id="startingDate" placeholder="วันที่/ช่วงเวลา (เช่น 01/01/2026)">
      <button onclick="addStartingIntern()">
        <img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:16px;height:16px;">
        เพิ่ม
      </button>
      <button onclick="toggleStartingAdd()">
        <img src="https://img.icons8.com/?size=100&id=QlMnqMXDMws3&format=png&color=000000" alt="close" style="width:16px;height:16px;">
        ยกเลิก
      </button>
    </div>
  </div>

  <!-- ENDING -->
  <div class="container">
    <div class="section-header">
      <span>
        <img src="https://img.icons8.com/?size=100&id=XVGCqo0GC6fq&format=png&color=000000" alt="hourglass" style="width:20px;height:20px;">
        นักศึกษาฝึกงานใกล้จบการฝึกงาน
      </span>
      <div class="h3-actions">
        <button onclick="toggleEndingAdd()">
          <img src="https://img.icons8.com/?size=100&id=XpyLr4ervzGM&format=png&color=000000" alt="add" style="width:14px;height:14px;">
          เพิ่มชื่อ
        </button>
        <button id="editEndingBtn" onclick="toggleEditEnding()">
          <img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;">
          แก้ไข
        </button>
      </div>
    </div>

    <div class="table-wrap">
      <div class="table-header-wrapper">
        <table>
          <thead>
            <tr>
              <th>ชื่อจริง/นามสกุล</th>
              <th>ชื่อเล่น</th>
              <th>ตำแหน่ง</th>
              <th>วันที่</th>
              <th>แจ้ง</th>
              <th id="endingActionCol" style="display:none;">ลบ</th>
            </tr>
          </thead>
        </table>
      </div>
      <div class="table-body-wrapper">
        <table>
          <tbody id="internEndingBody">
            <tr>
              <td colspan="5" class="loading">กำลังโหลด...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="endingAddForm">
      <input type="text" id="endingFullName" placeholder="ชื่อจริง/นามสกุล">
      <input type="text" id="endingNickName" placeholder="ชื่อเล่น">
      <input type="text" id="endingPosition" placeholder="ตำแหน่ง">
      <input type="text" id="endingDate" placeholder="วันที่/ช่วงเวลา">
      <button onclick="addEndingIntern()">
        <img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:16px;height:16px;">
        เพิ่ม
      </button>
      <button onclick="toggleEndingAdd()">
        <img src="https://img.icons8.com/?size=100&id=QlMnqMXDMws3&format=png&color=000000" alt="close" style="width:16px;height:16px;">
        ยกเลิก
      </button>
    </div>
  </div>

  <script>
    /* =========================
       FIX: $ is not defined
       ใช้แทน jQuery $
       ========================= */
    window.$ = function (id) { return document.getElementById(id); };
  </script>

  <script>
    /* =========================================================
       BACKEND ADAPTER (OFFLINE / localStorage)
    ========================================================= */
    (function initBackendAdapter() {
      const LS_KEY = "__pm_intern_offline_v1__";

      function readStore() {
        try {
          const raw = localStorage.getItem(LS_KEY);
          if (!raw) return null;
          return JSON.parse(raw);
        } catch (e) {
          return null;
        }
      }

      function writeStore(store) {
        try { localStorage.setItem(LS_KEY, JSON.stringify(store)); } catch (e) {}
      }

      function defaultStore() {
        return {
          interns: [
            { row: 1, name: "ตัวอย่าง", position: "Web Dev", morning: false, noon: false, status: "ทำงาน", note: "", fileLink: "", sheetName: "อัปเดตงาน" },
          ],
          starting: [],
          ending: []
        };
      }

      function getStore() {
        let s = readStore();
        if (!s) { s = defaultStore(); writeStore(s); }
        s.interns = Array.isArray(s.interns) ? s.interns : [];
        s.starting = Array.isArray(s.starting) ? s.starting : [];
        s.ending = Array.isArray(s.ending) ? s.ending : [];
        return s;
      }

      function ensureRowNumbers(list) {
        list.forEach((it, idx) => { it.row = idx + 1; });
        return list;
      }

      window.BACKEND = {
        mode: "offline",

        async getInternData() {
          const s = getStore();
          return ensureRowNumbers(s.interns.map(x => ({ ...x })));
        },

        async getInternStarting() {
          const s = getStore();
          return (s.starting || []).map(x => ({ ...x }));
        },

        async getInternEnding() {
          const s = getStore();
          return (s.ending || []).map(x => ({ ...x }));
        },

        async saveInternStarting(payload) {
          const s = getStore();
          s.starting = Array.isArray(payload) ? payload.map(x => ({ ...x })) : [];
          writeStore(s);
          return { success: true };
        },

        async saveInternEnding(payload) {
          const s = getStore();
          s.ending = Array.isArray(payload) ? payload.map(x => ({ ...x })) : [];
          writeStore(s);
          return { success: true };
        },

        async addNewIntern(name, position, note, fileLink) {
          const s = getStore();
          s.interns.push({
            row: s.interns.length + 1,
            name: String(name || "").trim(),
            position: String(position || "").trim(),
            morning: false,
            noon: false,
            status: "ทำงาน",
            note: String(note || "").trim(),
            fileLink: String(fileLink || "").trim(),
            sheetName: "อัปเดตงาน"
          });
          ensureRowNumbers(s.interns);
          writeStore(s);
          return { success: true };
        },

        async updateIntern(idVal, name, position, note, fileLink) {
          const s = getStore();
          const idx = s.interns.findIndex(x => String(x.name || "") === String(idVal || ""));
          if (idx === -1) return { success: false, message: "ไม่พบรายการที่ต้องการอัปเดต" };

          s.interns[idx] = {
            ...s.interns[idx],
            name: String(name || "").trim(),
            position: String(position || "").trim(),
            note: String(note || "").trim(),
            fileLink: String(fileLink || "").trim()
          };
          writeStore(s);
          return { success: true };
        },

        async deleteIntern(row) {
          const s = getStore();
          const r = Number(row);
          const idx = s.interns.findIndex(x => Number(x.row) === r);
          if (idx === -1) return { success: false, message: "ไม่พบแถวที่ต้องการลบ" };

          s.interns.splice(idx, 1);
          ensureRowNumbers(s.interns);
          writeStore(s);
          return { success: true };
        },

        async updateInternCheckbox(row, col, checked) {
          const s = getStore();
          const r = Number(row);
          const idx = s.interns.findIndex(x => Number(x.row) === r);
          if (idx === -1) return { success: false, message: "ไม่พบแถว" };

          if (String(col) === "D") s.interns[idx].morning = !!checked;
          if (String(col) === "E") s.interns[idx].noon = !!checked;

          writeStore(s);
          return { success: true };
        },

        async updateInternStatus(row, status) {
          const s = getStore();
          const r = Number(row);
          const idx = s.interns.findIndex(x => Number(x.row) === r);
          if (idx === -1) return { success: false, message: "ไม่พบแถว" };

          s.interns[idx].status = String(status || "ทำงาน");
          writeStore(s);
          return { success: true };
        }
      };
    })();
  </script>

  <script>
  /* =========================
     INTERN MODULE (OFFLINE) - NO BACKTICKS ✅
  ========================= */
  (function initInternTabOnce() {
    if (window.__internTabInited) return;
    window.__internTabInited = true;

    const S = window.__internState = window.__internState || {
      internData: [],
      internFiltered: [],
      internStartingData: [],
      internEndingData: [],
      editingStarting: false,
      editingEnding: false,
      positions: [],
      internManageMode: false,
      selectedPosition: ""
    };

    // ---------- helpers ----------
    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function escapeAttr(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    function addNiceBreaksToEscapedText(escapedText) {
      return String(escapedText || "").replaceAll("/", "/<wbr>").replaceAll("_", "_<wbr>");
    }

    function runInitNowOrOnReady(fn) {
      try {
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", fn, { once: true });
        } else {
          fn();
        }
      } catch (e) {
        // fallback
        setTimeout(fn, 0);
      }
    }

    // ---------- exposed controls ----------
    window.reloadInternTab = function () {
      // ไม่ล้างหน้า (กันหน้าโล่ง) แค่โหลด data ใหม่
      S.internData = [];
      S.internFiltered = [];
      S.internStartingData = [];
      S.internEndingData = [];
      window.loadInternTab(true);
    };

    window.clearInternFilters = function () {
      const searchInput = document.getElementById("internSearch");
      if (searchInput) searchInput.value = "";

      S.selectedPosition = "";
      const selectedText = document.getElementById("selectedPositionText");
      if (selectedText) selectedText.textContent = "ตำแหน่งทั้งหมด";

      const dropdownItems = document.getElementById("positionDropdownItems");
      if (dropdownItems) dropdownItems.classList.remove("open");

      window.filterInterns();
    };

    window.togglePositionDropdown = function () {
      const items = document.getElementById("positionDropdownItems");
      if (items) items.classList.toggle("open");
    };

    window.selectPosition = function (value, label) {
      S.selectedPosition = value || "";
      const t = document.getElementById("selectedPositionText");
      if (t) t.textContent = label || "ตำแหน่งทั้งหมด";
      const items = document.getElementById("positionDropdownItems");
      if (items) items.classList.remove("open");
      window.filterInterns();
    };

    window.updatePositionDropdown = function () {
      const items = document.getElementById("positionDropdownItems");
      if (!items) return;

      let html = '<div class="dd-item-intern" onclick="selectPosition(\'\', \'ตำแหน่งทั้งหมด\')">ตำแหน่งทั้งหมด</div>';

      (S.positions || []).forEach(function (pos) {
        const raw = String(pos || "");
        const escaped = raw
          .replaceAll("&", "&amp;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");

        const displayHtml = addNiceBreaksToEscapedText(escaped);

        html += '<div class="dd-item-intern" onclick="selectPosition(\'' + escaped + '\', \'' + escaped + '\')">' + displayHtml + '</div>';
      });

      items.innerHTML = html;
    };

    document.addEventListener("click", function (e) {
      const dd = document.getElementById("positionDropdownToggle");
      const items = document.getElementById("positionDropdownItems");
      if (!dd || !items) return;

      if (e.target && e.target.closest && e.target.closest("#positionDropdownToggle")) return;
      const container = dd.closest(".custom-dropdown-intern");
      if (container && !container.contains(e.target)) items.classList.remove("open");
    }, true);

    window.filterInterns = function () {
      const input = document.getElementById("internSearch");
      const kw = (input ? input.value : "").toLowerCase().trim();
      const selectedPos = S.selectedPosition || "";

      S.internFiltered = (S.internData || []).filter(function (i) {
        const matchName = !kw ||
          String(i.name || "").toLowerCase().includes(kw) ||
          String(i.position || "").toLowerCase().includes(kw);

        const matchPos = !selectedPos || String(i.position || "") === selectedPos;
        return matchName && matchPos;
      });

      renderInternTable();
    };

    window.loadInternTab = function () {
      fetchInternMain();
      fetchStarting();
      fetchEnding();
    };

    window.toggleStartingAdd = function () {
      const form = document.getElementById("startingAddForm");
      if (!form) return;
      form.classList.toggle("show");
    };

    window.toggleEndingAdd = function () {
      const form = document.getElementById("endingAddForm");
      if (!form) return;
      form.classList.toggle("show");
    };

    window.toggleEditStarting = function () {
      S.editingStarting = !S.editingStarting;
      const btn = document.getElementById("editStartingBtn");
      const col = document.getElementById("startingActionCol");

      if (btn) {
        btn.innerHTML = S.editingStarting
          ? '<img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:14px;height:14px;"> เสร็จ'
          : '<img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;"> แก้ไข';
      }

      if (col) col.style.display = S.editingStarting ? "table-cell" : "none";
      renderInternStartingTable();
    };

    window.toggleEditEnding = function () {
      S.editingEnding = !S.editingEnding;
      const btn = document.getElementById("editEndingBtn");
      const col = document.getElementById("endingActionCol");

      if (btn) {
        btn.innerHTML = S.editingEnding
          ? '<img src="https://img.icons8.com/?size=100&id=0YcjyJq4ROPU&format=png&color=000000" alt="check" style="width:14px;height:14px;"> เสร็จ'
          : '<img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="edit" style="width:14px;height:14px;"> แก้ไข';
      }

      if (col) col.style.display = S.editingEnding ? "table-cell" : "none";
      renderInternEndingTable();
    };

    window.toggleInternManageMode = function () {
      S.internManageMode = !S.internManageMode;

      const btn = document.getElementById("internManageBtn");
      const actionsHeader = document.getElementById("internActionsHeader");
      const actionsHeaderCol = document.getElementById("internActionsHeaderCol");
      const actionsBodyCol = document.getElementById("internActionsBodyCol");
      const addForm = document.getElementById("addInternForm");

      if (btn) btn.classList.toggle("active", S.internManageMode);

      const displayValue = S.internManageMode ? "" : "none";
      if (actionsHeader) actionsHeader.style.display = displayValue;
      if (actionsHeaderCol) actionsHeaderCol.style.display = displayValue;
      if (actionsBodyCol) actionsBodyCol.style.display = displayValue;

      if (addForm) {
        if (S.internManageMode) {
          addForm.classList.add("show");
          updateAddInternPositionDatalist();
        } else {
          addForm.classList.remove("show");
          if (window.$) {
            $("newInternName").value = "";
            $("newInternPosition").value = "";
            $("newInternNote").value = "";
            $("newInternFileLink").value = "";
          }
        }
      }

      renderInternTable();
    };

    // ---------- Starting/Ending add ----------
    window.addStartingIntern = function () {
      const fullName = (document.getElementById("startingFullName")?.value || "").trim();
      const nickName = (document.getElementById("startingNickName")?.value || "").trim();
      const position = (document.getElementById("startingPosition")?.value || "").trim();
      const dateRange = (document.getElementById("startingDate")?.value || "").trim();

      if (!fullName || !position || !dateRange) {
        alert("กรุณากรอกข้อมูลให้ครบ (ชื่อ, ตำแหน่ง, วันที่/ช่วงเวลา)");
        return;
      }

      S.internStartingData.push({ fullName: fullName, nickname: nickName, position: position, dateRange: dateRange, notifyStatus: "" });

      if (window.$) {
        $("startingFullName").value = "";
        $("startingNickName").value = "";
        $("startingPosition").value = "";
        $("startingDate").value = "";
      }

      renderInternStartingTable();
      saveStartingToStore();
    };

    window.deleteStartingIntern = function (idx) {
      if (!confirm("ลบข้อมูลนี้ใช่หรือไม่?")) return;
      S.internStartingData.splice(idx, 1);
      renderInternStartingTable();
      saveStartingToStore();
    };

    window.toggleStartingNotified = function (idx) {
      const row = S.internStartingData[idx];
      if (!row) return;
      row.notifyStatus = row.notifyStatus ? "" : "แจ้งแล้ว";
      renderInternStartingTable();
      saveStartingToStore();
    };

    window.addEndingIntern = function () {
      const fullName = (document.getElementById("endingFullName")?.value || "").trim();
      const nickName = (document.getElementById("endingNickName")?.value || "").trim();
      const position = (document.getElementById("endingPosition")?.value || "").trim();
      const dateRange = (document.getElementById("endingDate")?.value || "").trim();

      if (!fullName || !position || !dateRange) {
        alert("กรุณากรอกข้อมูลให้ครบ (ชื่อ, ตำแหน่ง, วันที่/ช่วงเวลา)");
        return;
      }

      S.internEndingData.push({ fullName: fullName, nickname: nickName, position: position, dateRange: dateRange, notifyStatus: "" });

      if (window.$) {
        $("endingFullName").value = "";
        $("endingNickName").value = "";
        $("endingPosition").value = "";
        $("endingDate").value = "";
      }

      renderInternEndingTable();
      saveEndingToStore();
    };

    window.deleteEndingIntern = function (idx) {
      if (!confirm("ลบข้อมูลนี้ใช่หรือไม่?")) return;
      S.internEndingData.splice(idx, 1);
      renderInternEndingTable();
      saveEndingToStore();
    };

    window.toggleEndingNotified = function (idx) {
      const row = S.internEndingData[idx];
      if (!row) return;
      row.notifyStatus = row.notifyStatus ? "" : "แจ้งแล้ว";
      renderInternEndingTable();
      saveEndingToStore();
    };

    // ---------- render main table ----------
    function renderInternTable() {
      const tbody = document.getElementById("internTableBody");
      if (!tbody) return;

      const colSpan = S.internManageMode ? 8 : 7;

      if (!S.internFiltered || !S.internFiltered.length) {
        tbody.innerHTML = '<tr><td colspan="' + colSpan + '" style="text-align:center;color:#999;">ไม่มีข้อมูล</td></tr>';
        return;
      }

      let html = "";
      S.internFiltered.forEach(function (i) {
        html += rowInternHtml(i);
      });
      tbody.innerHTML = html;
    }

    function rowInternHtml(i) {
      const rawName = String(i.name || "");
      const rawPos = String(i.position || "");
      const rawStatus = String(i.status || "ทำงาน");
      const rawNote = String(i.note || "");
      const rawFileLink = String(i.fileLink || "");
      const rawSheetName = String(i.sheetName || "อัปเดตงาน");

      const name = escapeHtml(rawName);
      const position = escapeHtml(rawPos);
      const note = escapeHtml(rawNote);
      const rowNum = Number(i.row);

      const morning =
        '<input type="checkbox" ' + (i.morning ? 'checked' : '') +
        ' onchange="onInternCheckChange(' + rowNum + ', \'D\', this.checked)">';

      const noon =
        '<input type="checkbox" ' + (i.noon ? 'checked' : '') +
        ' onchange="onInternCheckChange(' + rowNum + ', \'E\', this.checked)">';

      // ✅ ให้ตรงกับ CSS ของคุณ (.status-items)
      // ✅ ใช้ selectStatusDD (มีจริง) ไม่ใช่ pickStatus (ไม่มี)
// ✅ dropdown สถานะภาษาไทย
// ✅ dropdown สถานะภาษาไทย
const status =
  '<div class="status-dd" data-row="' + rowNum + '" data-value="' + escapeAttr(rawStatus) + '">' +
    '<div class="status-selected" onclick="toggleStatusDD(this)">' +
      '<span class="status-text">' + escapeHtml(rawStatus) + '</span>' +
      '<span>▾</span>' +
    '</div>' +
    '<div class="status-items">' +
      '<div class="status-item" onclick="selectStatusDD(this, \'ทำงาน\')">ทำงาน</div>' +
      '<div class="status-item" onclick="selectStatusDD(this, \'ลา\')">ลา</div>' +
      '<div class="status-item" onclick="selectStatusDD(this, \'ไม่มาทำงาน\')">ไม่มาทำงาน</div>' +
      '<div class="status-item" onclick="selectStatusDD(this, \'จบแล้ว\')">จบแล้ว</div>' +
    '</div>' +
  '</div>';

      let fileCell = '<span style="color:#999;">-</span>';
      if (rawFileLink.trim()) {
        const url = escapeAttr(rawFileLink.trim());
        fileCell =
          '<a href="' + url + '" target="_blank" rel="noopener">📄 ' + escapeHtml(rawSheetName) + '</a>';
      }

      let actionCell = "";
      if (S.internManageMode) {
        actionCell =
          '<td style="text-align: center;">' +
            '<div style="display: flex; justify-content: center; gap: 8px;">' +
              '<button title="แก้ไข" onclick="editIntern(' + rowNum + ')"' +
                ' style="background: none; border: none; cursor: pointer; padding: 8px 10px; border-radius: 10px; line-height: 1;">' +
                '<img src="https://img.icons8.com/?size=100&id=ulYKuVdTiawZ&format=png&color=000000" alt="Edit" style="width: 20px; height: 20px;">' +
              '</button>' +
              '<button title="ลบ" onclick="deleteIntern(' + rowNum + ', \'' + escapeAttr(rawName) + '\')"' +
                ' style="background: none; border: none; cursor: pointer; padding: 8px 10px; border-radius: 10px; line-height: 1; color: #ef4444;">' +
                '<img src="https://img.icons8.com/?size=100&id=Gx6408t2AnyJ&format=png&color=000000" alt="Delete" style="width: 20px; height: 20px;">' +
              '</button>' +
            '</div>' +
          '</td>';
      }

      return (
        '<tr>' +
          '<td><b>' + name + '</b></td>' +
          '<td>' + position + '</td>' +
          '<td>' + morning + '</td>' +
          '<td>' + noon + '</td>' +
          '<td>' + status + '</td>' +
          '<td>' + note + '</td>' +
          '<td>' + fileCell + '</td>' +
          actionCell +
        '</tr>'
      );
    }

    function renderInternStartingTable() {
      const tbody = document.getElementById("internStartingBody");
      if (!tbody) return;

      const colSpan = S.editingStarting ? 6 : 5;

      if (!S.internStartingData || !S.internStartingData.length) {
        tbody.innerHTML = '<tr><td colspan="' + colSpan + '" style="text-align:center;color:#999;">ไม่มีข้อมูล</td></tr>';
        return;
      }

      let html = "";
      S.internStartingData.forEach(function (i, idx) {
        const nick = (i.nickName ?? i.nickname ?? "");
        const date = (i.date ?? i.dateRange ?? "");
        const notified = !!(i.notified || i.notifyStatus);

        html +=
          '<tr>' +
            '<td>' + escapeHtml(i.fullName || "") + '</td>' +
            '<td>' + escapeHtml(nick) + '</td>' +
            '<td>' + escapeHtml(i.position || "") + '</td>' +
            '<td style="text-align:center;">' + (escapeHtml(date) || "-") + '</td>' +
            '<td style="text-align:center;">' +
              '<input type="checkbox" ' + (notified ? "checked" : "") + ' onchange="toggleStartingNotified(' + idx + ')">' +
            '</td>';

        if (S.editingStarting) {
          html +=
            '<td style="text-align:center;">' +
              '<button class="delete-btn" onclick="deleteStartingIntern(' + idx + ')">' +
                '<img src="https://img.icons8.com/?size=100&id=Gx6408t2AnyJ&format=png&color=000000" alt="trash" style="width:14px;height:14px;">' +
              '</button>' +
            '</td>';
        }

        html += '</tr>';
      });

      tbody.innerHTML = html;
    }

    function renderInternEndingTable() {
      const tbody = document.getElementById("internEndingBody");
      if (!tbody) return;

      const colSpan = S.editingEnding ? 6 : 5;

      if (!S.internEndingData || !S.internEndingData.length) {
        tbody.innerHTML = '<tr><td colspan="' + colSpan + '" style="text-align:center;color:#999;">ไม่มีข้อมูล</td></tr>';
        return;
      }

      let html = "";
      S.internEndingData.forEach(function (i, idx) {
        const nick = (i.nickName ?? i.nickname ?? "");
        const date = (i.date ?? i.dateRange ?? "");
        const notified = !!(i.notified || i.notifyStatus);

        html +=
          '<tr>' +
            '<td>' + escapeHtml(i.fullName || "") + '</td>' +
            '<td>' + escapeHtml(nick) + '</td>' +
            '<td>' + escapeHtml(i.position || "") + '</td>' +
            '<td style="text-align:center;">' + (escapeHtml(date) || "-") + '</td>' +
            '<td style="text-align:center;">' +
              '<input type="checkbox" ' + (notified ? "checked" : "") + ' onchange="toggleEndingNotified(' + idx + ')">' +
            '</td>';

        if (S.editingEnding) {
          html +=
            '<td style="text-align:center;">' +
              '<button class="delete-btn" onclick="deleteEndingIntern(' + idx + ')">' +
                '<img src="https://img.icons8.com/?size=100&id=Gx6408t2AnyJ&format=png&color=000000" alt="trash" style="width:14px;height:14px;">' +
              '</button>' +
            '</td>';
        }

        html += '</tr>';
      });

      tbody.innerHTML = html;
    }

    // ---------- Data fetch ----------
    async function fetchInternMain() {
      try {
        const rows = await window.BACKEND.getInternData();
        S.internData = Array.isArray(rows) ? rows : [];
        S.internFiltered = S.internData.slice();

        const posSet = new Set();
        S.internData.forEach(function (i) { if (i.position) posSet.add(i.position); });
        S.positions = Array.from(posSet).sort(function (a, b) { return String(a).localeCompare(String(b), "th"); });

        window.updatePositionDropdown();
        updateAddInternPositionDatalist();
        window.updateInternPositionDatalist(S.positions);
        renderInternTable();
      } catch (err) {
        console.error("โหลด intern ไม่สำเร็จ:", err);
        S.internData = [];
        S.internFiltered = [];
        S.positions = [];
        window.updatePositionDropdown();
        renderInternTable();
      }
    }
    window.fetchInternMain = fetchInternMain;

    async function fetchStarting() {
      try {
        const rows = await window.BACKEND.getInternStarting();
        S.internStartingData = Array.isArray(rows) ? rows : [];
        renderInternStartingTable();
      } catch (e) {
        S.internStartingData = [];
        renderInternStartingTable();
      }
    }

    async function fetchEnding() {
      try {
        const rows = await window.BACKEND.getInternEnding();
        S.internEndingData = Array.isArray(rows) ? rows : [];
        renderInternEndingTable();
      } catch (e) {
        S.internEndingData = [];
        renderInternEndingTable();
      }
    }

    async function saveStartingToStore() {
      const payload = (S.internStartingData || []).map(function (r) {
        return {
          fullName: r.fullName || "",
          nickname: (r.nickname ?? r.nickName ?? ""),
          position: r.position || "",
          dateRange: (r.dateRange ?? r.date ?? ""),
          notifyStatus: r.notifyStatus ? String(r.notifyStatus) : ""
        };
      });

      try {
        const res = await window.BACKEND.saveInternStarting(payload);
        if (!res?.success) alert(res?.message || "บันทึก Starting ไม่สำเร็จ");
      } catch (err) {
        alert("บันทึก Starting ไม่สำเร็จ: " + (err?.message || err));
      }
    }

    async function saveEndingToStore() {
      const payload = (S.internEndingData || []).map(function (r) {
        return {
          fullName: r.fullName || "",
          nickname: (r.nickname ?? r.nickName ?? ""),
          position: r.position || "",
          dateRange: (r.dateRange ?? r.date ?? ""),
          notifyStatus: r.notifyStatus ? String(r.notifyStatus) : ""
        };
      });

      try {
        const res = await window.BACKEND.saveInternEnding(payload);
        if (!res?.success) alert(res?.message || "บันทึก Ending ไม่สำเร็จ");
      } catch (err) {
        alert("บันทึก Ending ไม่สำเร็จ: " + (err?.message || err));
      }
    }

    // ---------- datalist ----------
    function updateAddInternPositionDatalist() {
      const dl = document.getElementById("addInternPositionDatalist");
      if (!dl) return;
      dl.innerHTML = "";
      (S.positions || []).forEach(function (pos) {
        const opt = document.createElement("option");
        opt.value = pos;
        dl.appendChild(opt);
      });
    }

    window.updateInternPositionDatalist = function (positions) {
      const dl = document.getElementById("internPositionDatalist");
      if (!dl) return;
      dl.innerHTML = "";
      (positions || []).forEach(function (pos) {
        const opt = document.createElement("option");
        opt.value = pos;
        dl.appendChild(opt);
      });
    };

    // ---------- add form submit ----------
    window.addNewInternSubmit = async function () {
      const name = (document.getElementById("newInternName")?.value || "").trim();
      const position = (document.getElementById("newInternPosition")?.value || "").trim();
      const note = (document.getElementById("newInternNote")?.value || "").trim();
      const fileLink = (document.getElementById("newInternFileLink")?.value || "").trim();

      if (!name || !position) {
        alert("กรุณากรอกชื่อและตำแหน่ง");
        return;
      }

      try {
        const res = await window.BACKEND.addNewIntern(name, position, note, fileLink);
        if (res?.success) {
          if (window.$) {
            $("newInternName").value = "";
            $("newInternPosition").value = "";
            $("newInternNote").value = "";
            $("newInternFileLink").value = "";
          }
          window.reloadInternTab();
        } else {
          alert(res?.message || "เพิ่มไม่สำเร็จ");
        }
      } catch (err) {
        alert("เกิดข้อผิดพลาด: " + (err?.message || err));
      }
    };

    window.hideAddInternForm = function () {
      S.internManageMode = false;
      const btn = document.getElementById("internManageBtn");
      const actionsHeader = document.getElementById("internActionsHeader");
      const actionsHeaderCol = document.getElementById("internActionsHeaderCol");
      const actionsBodyCol = document.getElementById("internActionsBodyCol");
      const addForm = document.getElementById("addInternForm");

      if (btn) btn.classList.remove("active");
      if (actionsHeader) actionsHeader.style.display = "none";
      if (actionsHeaderCol) actionsHeaderCol.style.display = "none";
      if (actionsBodyCol) actionsBodyCol.style.display = "none";

      if (addForm) {
        addForm.classList.remove("show");
        if (window.$) {
          $("newInternName").value = "";
          $("newInternPosition").value = "";
          $("newInternNote").value = "";
          $("newInternFileLink").value = "";
        }
      }

      renderInternTable();
    };

    // ---------- modal open/close ----------
    window.openAddInternModal = function () {
      $("internModalTitle").textContent = "เพิ่มเด็กฝึกงาน";
      $("internIdHidden").value = "";
      $("internName").value = "";
      $("internPosition").value = "";
      $("internNote").value = "";
      $("internFileLink").value = "";

      window.updateInternPositionDatalist(S.positions || []);
      $("internModal").classList.add("show");
    };

    window.openEditInternModal = function (name, position, note, fileLink) {
      $("internModalTitle").textContent = "แก้ไขเด็กฝึกงาน";
      $("internIdHidden").value = name || "";
      $("internName").value = name || "";
      $("internPosition").value = position || "";
      $("internNote").value = note || "";
      $("internFileLink").value = fileLink || "";

      window.updateInternPositionDatalist(S.positions || []);
      $("internModal").classList.add("show");
    };

    window.closeInternModal = function () {
      $("internModal").classList.remove("show");
    };

    runInitNowOrOnReady(function () {
      const modal = document.getElementById("internModal");
      if (modal) {
        modal.addEventListener("click", function (e) {
          if (e.target === modal) window.closeInternModal();
        });
      }
    });

    window.editIntern = function (rowNum) {
      const it = (S.internData || []).find(function (x) { return Number(x.row) === Number(rowNum); });
      if (!it) return;
      window.openEditInternModal(it.name || "", it.position || "", it.note || "", it.fileLink || "");
    };

    // ---------- submit modal ----------
    window.submitIntern = async function () {
      const name = ($("internName").value || "").trim();
      const position = ($("internPosition").value || "").trim();
      const note = ($("internNote").value || "").trim();
      const fileLink = ($("internFileLink").value || "").trim();

      if (!name || !position) {
        alert("กรุณากรอกชื่อและตำแหน่ง");
        return;
      }

      const idVal = ($("internIdHidden").value || "").trim();

      try {
        let res;
        if (idVal) res = await window.BACKEND.updateIntern(idVal, name, position, note, fileLink);
        else res = await window.BACKEND.addNewIntern(name, position, note, fileLink);

        if (res?.success) {
          window.closeInternModal();
          window.reloadInternTab();
        } else {
          alert(res?.message || (idVal ? "อัปเดตไม่สำเร็จ" : "เพิ่มไม่สำเร็จ"));
        }
      } catch (err) {
        alert("เกิดข้อผิดพลาด: " + (err?.message || err));
      }
    };

    // ---------- checkbox & status update ----------
    window.onInternCheckChange = async function (row, col, checked) {
      try {
        const res = await window.BACKEND.updateInternCheckbox(row, col, !!checked);
        if (res?.success) return;
        alert(res?.message || "บันทึก checkbox ไม่สำเร็จ");
        fetchInternMain();
      } catch (err) {
        alert(err?.message || String(err));
        fetchInternMain();
      }
    };

    async function onInternStatusChange(row, status) {
      try {
        const res = await window.BACKEND.updateInternStatus(row, status);
        if (res?.success) return;
        alert(res?.message || "บันทึกสถานะไม่สำเร็จ");
        fetchInternMain();
      } catch (err) {
        alert(err?.message || String(err));
        fetchInternMain();
      }
    }

window.toggleStatusDD = function (el) {
  const items = el ? el.nextElementSibling : null;
  if (!items) return;
  
  // ปิด dropdown อื่นๆ ก่อน
  document.querySelectorAll(".status-items.open").forEach(function (other) {
    if (other !== items) other.classList.remove("open");
  });
  
  // Toggle dropdown นี้
  const willOpen = !items.classList.contains("open");
  items.classList.toggle("open");
  
  // คำนวณตำแหน่งที่ถูกต้อง
  if (willOpen) {
    const rect = el.getBoundingClientRect();
    items.style.top = (rect.bottom + 6) + "px";
    items.style.left = rect.left + "px";
  }
};

    window.selectStatusDD = function (el, value) {
      const wrap = el ? el.closest(".status-dd") : null;
      if (!wrap) return;

      const row = wrap.dataset.row;
      wrap.dataset.value = value;

      const textEl = wrap.querySelector(".status-text");
      if (textEl) textEl.textContent = value;

      const items = wrap.querySelector(".status-items");
      if (items) items.classList.remove("open");

      onInternStatusChange(row, value);
    };

    document.addEventListener("click", function (e) {
      document.querySelectorAll(".status-items.open").forEach(function (items) {
        if (!items.parentElement.contains(e.target)) items.classList.remove("open");
      });
    }, true);

    // ---------- delete ----------
    window.deleteIntern = async function (row, name) {
      if (!confirm('ยืนยันลบ "' + name + '" ?')) return;

      try {
        const res = await window.BACKEND.deleteIntern(row);
        if (res?.success) window.reloadInternTab();
        else alert(res?.message || "ลบไม่สำเร็จ");
      } catch (err) {
        alert("เกิดข้อผิดพลาด: " + (err?.message || err));
      }
    };

    // ---------- init ----------
    runInitNowOrOnReady(function () {
      window.loadInternTab();
    });
  })();
</script>


  <script>
    /* ========= Scroll sync ========= */
    (function () {
      function bindOneTableWrap(wrap) {
        const head = wrap.querySelector(".table-header-wrapper");
        const body = wrap.querySelector(".table-body-wrapper");
        if (!head || !body) return;

        if (body.__boundScrollSync) return;
        body.__boundScrollSync = true;

        const sync = () => { head.scrollLeft = body.scrollLeft; };

body.addEventListener("scroll", () => {
  requestAnimationFrame(sync);
  // ปิด dropdown ทั้งหมดเมื่อ scroll
  document.querySelectorAll(".status-items.open").forEach(function (items) {
    items.classList.remove("open");
  });
}, { passive: true });

head.addEventListener("scroll", () => {
          if (body.scrollLeft !== head.scrollLeft) body.scrollLeft = head.scrollLeft;
        }, { passive: true });

        sync();
      }

      function bindAll() {
        document.querySelectorAll(".table-wrap").forEach(bindOneTableWrap);
      }

      document.addEventListener("DOMContentLoaded", bindAll);
      window.addEventListener("load", bindAll);
      window.addEventListener("resize", bindAll);

      const mo = new MutationObserver(() => bindAll());
      mo.observe(document.documentElement, { childList: true, subtree: true });
    })();
  </script>

</body>
</html>
